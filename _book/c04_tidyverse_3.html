<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Taller de programación en el lenguaje de programación R para servidores de SERNANP.">

<title>Taller de programación R - SERNANP - 6&nbsp; Gráficos en R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./c04_tidyverse_1.html" rel="prev">
<link href="./https://geoportal.sernanp.gob.pe/wp-content/uploads/2019/12/logo_sernanp-01.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Taller de programación R - SERNANP - 6&nbsp; Gráficos en R">
<meta property="og:description" content="A side-by-side comparison of the Polars and Pandas libraries.">
<meta property="og:image" content="https://geoportal.sernanp.gob.pe/wp-content/uploads/2019/12/logo_sernanp-01.png">
<meta property="og:site-name" content="Taller de programación R - SERNANP">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://geoportal.sernanp.gob.pe/wp-content/uploads/2019/12/logo_sernanp-01.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Taller de programación R - SERNANP</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="./header_right.qmd">
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ryali93/rsernanp/tree/master/book/"><i class="bi bi-github" role="img" aria-label="Source Code">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown  compact">
    <a class="nav-link dropdown-toggle" href="#" id="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-share" role="img" aria-label="Share">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="">    
        <li>
    <a class="dropdown-item" href="https://twitter.com/intent/tweet?url=|url|"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|"><i class="bi bi-facebook" role="img">
</i> 
 <span class="dropdown-text">Facebook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="dropdown-text">LinkedIn</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Gráficos en R</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./fig/PiqueroCamanay.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Presentación</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c01_introduccion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introducción a los lenguajes de programación</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c02_intro_R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Primeros pasos en R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c03_intro_R2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Control de Flujo y funciones</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c04_tidyverse_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulación de datos con tidyverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c04_tidyverse_3.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Gráficos en R</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#plot-con-r-base" id="toc-plot-con-r-base" class="nav-link active" data-scroll-target="#plot-con-r-base"><span class="toc-section-number">6.1</span>  Plot con R base</a></li>
  <li><a href="#ahora-sí-ggplot2" id="toc-ahora-sí-ggplot2" class="nav-link" data-scroll-target="#ahora-sí-ggplot2"><span class="toc-section-number">6.2</span>  Ahora sí! Ggplot2</a>
  <ul class="collapse">
  <li><a href="#primeros-pasos" id="toc-primeros-pasos" class="nav-link" data-scroll-target="#primeros-pasos"><span class="toc-section-number">6.2.1</span>  Primeros pasos</a></li>
  <li><a href="#el-data-frame-millas" id="toc-el-data-frame-millas" class="nav-link" data-scroll-target="#el-data-frame-millas"><span class="toc-section-number">6.2.2</span>  El data frame millas</a></li>
  <li><a href="#creando-un-gráfico-con-ggplot" id="toc-creando-un-gráfico-con-ggplot" class="nav-link" data-scroll-target="#creando-un-gráfico-con-ggplot"><span class="toc-section-number">6.2.3</span>  Creando un gráfico con ggplot</a></li>
  <li><a href="#una-plantilla-de-gráficos" id="toc-una-plantilla-de-gráficos" class="nav-link" data-scroll-target="#una-plantilla-de-gráficos"><span class="toc-section-number">6.2.4</span>  Una plantilla de gráficos</a></li>
  </ul></li>
  <li><a href="#mapeos-estéticos" id="toc-mapeos-estéticos" class="nav-link" data-scroll-target="#mapeos-estéticos"><span class="toc-section-number">6.3</span>  Mapeos estéticos</a>
  <ul class="collapse">
  <li><a href="#problemas-comunes" id="toc-problemas-comunes" class="nav-link" data-scroll-target="#problemas-comunes"><span class="toc-section-number">6.3.1</span>  Problemas comunes</a></li>
  </ul></li>
  <li><a href="#separar-en-facetas" id="toc-separar-en-facetas" class="nav-link" data-scroll-target="#separar-en-facetas"><span class="toc-section-number">6.4</span>  Separar en facetas</a></li>
  <li><a href="#objetos-geométricos" id="toc-objetos-geométricos" class="nav-link" data-scroll-target="#objetos-geométricos"><span class="toc-section-number">6.5</span>  Objetos geométricos</a></li>
  <li><a href="#transformaciones-estadísticas" id="toc-transformaciones-estadísticas" class="nav-link" data-scroll-target="#transformaciones-estadísticas"><span class="toc-section-number">6.6</span>  Transformaciones estadísticas</a></li>
  <li><a href="#ajustes-de-posición" id="toc-ajustes-de-posición" class="nav-link" data-scroll-target="#ajustes-de-posición"><span class="toc-section-number">6.7</span>  Ajustes de posición</a></li>
  <li><a href="#sistemas-de-coordenadas" id="toc-sistemas-de-coordenadas" class="nav-link" data-scroll-target="#sistemas-de-coordenadas"><span class="toc-section-number">6.8</span>  Sistemas de coordenadas</a></li>
  <li><a href="#la-gramática-de-gráficos-en-capas" id="toc-la-gramática-de-gráficos-en-capas" class="nav-link" data-scroll-target="#la-gramática-de-gráficos-en-capas"><span class="toc-section-number">6.9</span>  La gramática de gráficos en capas</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ryali93/rsernanp/edit/master/book/c04_tidyverse_3.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/ryali93/rsernanp/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/ryali93/rsernanp/blob/master/book/c04_tidyverse_3.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Gráficos en R</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>“Un simple gráfico ha brindado más información a la mente del analista de datos que cualquier otro dispositivo”. — John Tukey</strong></p>
<p>La función <code>plot()</code> de R base es una función que permite crear gráficos básicos, como diagramas de dispersión, líneas, histogramas, etc. Permite configurar varios argumentos que se pueden utilizar para personalizar el gráfico, como el tipo de línea, color, tamaño de punto, etc.</p>
<p>Por otro lado, la librería <code>ggplot2</code> es una librería de visualización de datos en R que permite crear gráficos más complejos y elegantes, utilizando una sintaxis declarativa. ggplot2 se basa en el concepto de capas, lo que significa que se pueden agregar diferentes capas al gráfico para mostrar diferentes aspectos de los datos. Además, también proporciona una amplia gama de herramientas para personalizar los gráficos, incluyendo temas, escalas de colores, etiquetas de ejes y títulos.</p>
<p>En este capítulo se explicará cómo visualizar tus datos usando el paquete ggplot2. Para profundizar los fundamentos fundamentos teóricos de ggplot2 antes de comenzar, te recomendamos leer “La gramática de gráficos en capas”, <a href="http://vita.had.co.nz/papers/layered-grammar.pdf" class="uri">http://vita.had.co.nz/papers/layered-grammar.pdf</a>.</p>
<section id="plot-con-r-base" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="plot-con-r-base"><span class="header-section-number">6.1</span> Plot con R base</h2>
<p>Aquí haremos algunos ejemplos sobre cómo realizar gráficos sencillos con <code>plot()</code> a partir de un dataframe especificando los argumentos x e y.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) , <span class="dv">100</span> , <span class="at">replace=</span>T),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fl">0.2</span><span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) , <span class="dv">100</span> , <span class="at">replace=</span>T)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>data<span class="sc">$</span>x, <span class="at">y=</span>data<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aquí mostramos una breve descripción de la personalización más común: - cex: Tamaño de puntos - xlim y ylim: Límites de los ejes X e Y - pch: Forma de los marcadores. Ver todos <a href="https://r-graph-gallery.com/6-graph-parameters-reminder.html">aquí</a>. - xlab y ylab: Etiquetas de los ejes X e Y - col: Color del marcador - main: Título del gráfico</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250</span>) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">18</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="dv">2</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"#69b3a2"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Valor de X"</span>, <span class="at">ylab=</span><span class="st">"Valor de Y"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Un scatterplot simple"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"#69b3a2"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Valor de X"</span>, <span class="at">ylab=</span><span class="st">"Valor de Y"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Un scatterplot simple"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">pch=</span><span class="st">"*"</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>), <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">cex=</span><span class="fl">0.8</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">"Leyenda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="ahora-sí-ggplot2" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="ahora-sí-ggplot2"><span class="header-section-number">6.2</span> Ahora sí! Ggplot2</h2>
<p>Esta sección se centra en ggplot2, uno de los paquetes principales de Tidyverse. Lo primero que haremos será comprobar si tenemos instalado <code>tidyverse</code> y si no lo tenemos, primero deberás instalarlo y luego ejecutar <code>library()</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Solo es necesario que instales los paquetes una única vez; sin embargo, tendrás que cargarlos siempre que inicies una nueva sesión.</p>
<p>Cuando necesitemos especificar la procedencia de una función (o un conjunto de datos), usaremos el formato especial <code>paquete::funcion()</code>. Por ejemplo, <code>ggplot2::ggplot()</code> dice explícitamente que estamos usando la función <strong>ggplot()</strong> del paquete <strong>ggplot2</strong>.</p>
<p>Además del Tidyverse, es necesario que cargues el paquete datos, ya que en él están contenidas las versiones en español de los datos que utilizaremos en este capítulo:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("datos")</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="primeros-pasos" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="primeros-pasos"><span class="header-section-number">6.2.1</span> Primeros pasos</h3>
<p>En este primer ejercicio usaremos la base de datos <code>millas</code>. Simplemente analizando los datos intentaremos responder a las preguntas: ¿los automóviles con motores grandes consumen más combustible que los automóviles con motores pequeños? ¿Cómo es la relación entre el tamaño del motor y la eficiencia del combustible? ¿Es positiva? ¿Es negativa? ¿Es lineal o no lineal?</p>
</section>
<section id="el-data-frame-millas" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="el-data-frame-millas"><span class="header-section-number">6.2.2</span> El data frame millas</h3>
<p>Esta data la podemos cargar con la librería datos, <strong>(datos::millas)</strong>. El data frame <strong>millas</strong> contiene observaciones para 38 modelos de automóviles recopiladas por la Agencia de Protección Ambiental de los EE. UU.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>millas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
   fabricante modelo     cilindrada  anio cilindros transmision traccion ciudad
   &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;
 1 audi       a4                1.8  1999         4 auto(l5)    d            18
 2 audi       a4                1.8  1999         4 manual(m5)  d            21
 3 audi       a4                2    2008         4 manual(m6)  d            20
 4 audi       a4                2    2008         4 auto(av)    d            21
 5 audi       a4                2.8  1999         6 auto(l5)    d            16
 6 audi       a4                2.8  1999         6 manual(m5)  d            18
 7 audi       a4                3.1  2008         6 auto(av)    d            18
 8 audi       a4 quattro        1.8  1999         4 manual(m5)  4            18
 9 audi       a4 quattro        1.8  1999         4 auto(l5)    4            16
10 audi       a4 quattro        2    2008         4 manual(m6)  4            20
# ℹ 224 more rows
# ℹ 3 more variables: autopista &lt;int&gt;, combustible &lt;chr&gt;, clase &lt;chr&gt;</code></pre>
</div>
</div>
<p>Entre las variables de millas se encuentran:</p>
<ul>
<li><strong>cilindrada:</strong> tamaño del motor del automóvil, en litros.</li>
<li><strong>autopista:</strong> eficiencia del uso de combustible de un automóvil en carretera, en millas por galón. Al recorrer la misma distancia, un automóvil de baja eficiencia consume más combustible que un automóvil de alta eficiencia.</li>
</ul>
<p>Para obtener más información sobre el data frame millas, abre su página de ayuda ejecutando <code>?millas</code>.</p>
</section>
<section id="creando-un-gráfico-con-ggplot" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="creando-un-gráfico-con-ggplot"><span class="header-section-number">6.2.3</span> Creando un gráfico con ggplot</h3>
<p>Para graficar <strong><code>millas</code></strong>, ejecuta este código para poner <strong><code>cilindrada</code></strong> en el eje x y <strong><code>autopista</code></strong> en el eje y:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El gráfico muestra una relación negativa entre el tamaño del motor <strong>(cilindrada)</strong> y la eficiencia del combustible <strong>(autopista)</strong>. En otras palabras, <strong>los vehículos con motores grandes usan más combustible</strong>. Este resultado, ¿confirma o refuta tu hipótesis acerca de la relación entre la eficiencia del combustible y el tamaño del motor?</p>
<p><strong>Para comenzar un gráfico con ggplot2 se utiliza la función ggplot(). ggplot() crea un sistema de coordenadas al que puedes agregar capas</strong>. El <strong>primer</strong> argumento de ggplot() es el <strong>conjunto de datos</strong> que se utilizará en el gráfico. Si corres ggplot(data = millas), obtendrás un gráfico vacío. Como no es muy interesante, no vamos a mostrarlo aquí.</p>
<p>Para completar tu gráfico debes agregar una o más capas a ggplot(). La función <strong>geom_point()</strong> agrega una capa de puntos al gráfico, lo que crea un <strong>diagrama de dispersión (o scatterplot)</strong>. ggplot2 incluye muchas funciones geom, cada una de las cuales agrega un tipo de capa diferente a un gráfico. Aprenderás muchas de ellas a lo largo de este capítulo.</p>
<p>Cada función geom en ggplot2 tiene un argumento de mapping. Este define cómo se “mapean” o se asignan las variables del conjunto de datos a propiedades visuales. El argumento de mapping siempre aparece emparejado con aes() y los argumentos x e y dentro de aes() especifican qué variables asignar a estos ejes. ggplot2 busca la variable asignada en el argumento data, en este caso, millas.</p>
</section>
<section id="una-plantilla-de-gráficos" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="una-plantilla-de-gráficos"><span class="header-section-number">6.2.4</span> Una plantilla de gráficos</h3>
<p>Convirtamos ahora este código en una plantilla reutilizable para hacer gráficos con ggplot2. Para hacer un gráfico, reemplaza las secciones entre corchetes en el siguiente código con un conjunto de datos, una función geom o una colección de mapeos.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El resto de este capítulo te mostrará cómo utilizar y adaptar esta plantilla para crear diferentes tipos de gráficos. Comenzaremos por el componente <strong><code>&lt;MAPEOS&gt;</code></strong></p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- Ejecuta ggplot(data = millas). ¿Qué observas?</span></p>
<p><span style="color:blue">- ¿Cuántas filas hay en millas? ¿Cuántas columnas?</span></p>
<p><span style="color:blue">- ¿Qué describe la variable traccion? Lee la ayuda de ?millas para encontrar la respuesta.</span></p>
<p><span style="color:blue">- Realiza un gráfico de dispersión de autopista versus cilindros.</span></p>
<p><span style="color:blue">- ¿Qué sucede cuando haces un gráfico de dispersión (scatterplot) de clase versus traccion? ¿Por qué no es útil este gráfico?</span></p>
</section>
</section>
<section id="mapeos-estéticos" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="mapeos-estéticos"><span class="header-section-number">6.3</span> Mapeos estéticos</h2>
<p><strong>“El mayor valor de una imagen es cuando nos obliga a observar lo que no esperábamos ver”. — John Tukey</strong></p>
<p>En el siguiente gráfico, un grupo de puntos (resaltados en rojo) parece quedar fuera de la tendencia lineal. Estos automóviles tienen un kilometraje mayor de lo que esperaríamos. ¿Cómo puedes explicar estos vehículos?</p>
<p align="center">
<img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-7-1.png" width="500">
</p>
<p>Supongamos que estos automóviles son híbridos. Una forma de probar esta hipótesis es observando la variable que indica la clase de cada automóvil. La variable clase del conjunto de datos de millas clasifica los autos en grupos como compacto, mediano y SUV. Si los puntos periféricos corresponden a automóviles híbridos, deberían estar clasificados como compactos o, tal vez, subcompactos (ten en cuenta que estos datos se recopilaron antes de que las camionetas híbridas y SUV se hicieran populares).</p>
<p>Puedes agregar una tercera variable, como clase, a un diagrama de dispersión bidimensional asignándolo a un parámetro estético. Un parámetro estético (o estética) es una propiedad visual de los objetos de un gráfico. Las estéticas incluye cosas como el tamaño, la forma o el color de tus puntos. Puedes mostrar un punto (como el siguiente) de diferentes maneras si cambias los valores de sus propiedades estéticas. Como ya usamos la palabra “valor” para describir los datos, usemos la palabra “nivel” para describir las propiedades estéticas. Aquí cambiamos los niveles del tamaño, la forma y el color de un punto para que el punto sea pequeño, triangular o azul:</p>
<p align="center">
<img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-8-1.png" width="500">
</p>
<p>El mapeo entre las propiedades estéticas de tu gráfico y las variables de tu dataset te permite comunicar información sobre tus datos. Por ejemplo, puedes asignar los colores de los puntos de acuerdo a la variable clase para indicar a qué clase pertenece cada automóvil.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> clase))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>(Si prefieres el inglés británico, como Hadley, puedes usar <strong>colour</strong> en lugar de color).</p>
<p>Para mapear (o asignar) una estética a una variable, debes asociar el nombre de la estética al de la variable <strong>dentro de aes()</strong>. ggplot2 <strong>asignará automáticamente un nivel único</strong> de la estética (en este ejemplo, un color) a cada valor único de la variable. <strong>Este proceso es conocido como escalamiento (scaling)</strong>. ggplot2 acompañará el gráfico con una leyenda que explica qué niveles corresponden a qué valores.</p>
<p>Los colores revelan que muchos de los puntos inusuales son automóviles de <strong>dos asientos</strong>. ¡Estos no parecen híbridos y son, de hecho, automóviles deportivos! Los automóviles deportivos tienen motores grandes, como las camionetas todo terreno o pickups, pero su cuerpo es pequeño, como los automóviles medianos y compactos, lo que mejora su consumo de gasolina. En retrospectiva, es poco probable que estos automóviles sean híbridos, ya que tienen motores grandes.</p>
<p>En el ejemplo anterior asignamos la variable clase a la estética de color, pero podríamos haberla asignado a la estética del tamaño del mismo modo. En este caso, <strong>el tamaño exacto de cada punto revelaría a qué clase pertenece</strong>. <strong>Recibimos</strong> aquí una advertencia <strong>(warning)</strong>, porque mapear <strong>una variable no ordenada</strong> (clase) a una estética ordenada (size) <strong>no es una buena idea</strong>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">size =</span> clase))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>También podríamos haber asignado la variable clase a la estética <strong><code>alpha</code></strong>, que controla la <strong>transparencia</strong> de los puntos, o a la estética shape que controla la <strong>forma (shape)</strong> de los puntos.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">alpha =</span> clase))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">shape =</span> clase))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The shape palette can deal with a maximum of 6 discrete values because
more than 6 becomes difficult to discriminate; you have 7. Consider
specifying shapes manually if you must have them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 62 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>¿Qué pasó con los SUV? ggplot2 solo puede usar seis formas a la vez</strong>. <strong>De forma predeterminada</strong>, los grupos adicionales no se grafican cuando se emplea la estética de la forma (shape).</p>
<p>Para cada estética utilizamos aes() para asociar su nombre con la variable seleccionada para graficar. <strong>La función aes() reúne cada una de las asignaciones estéticas utilizadas por una capa y las pasa al argumento de mapeo de la capa</strong>. La sintaxis resalta una visión útil sobre x e y: las ubicaciones de x e y de un punto son en sí mismas también estéticas, es decir propiedades visuales que se puede asignar a las variables para mostrar información sobre los datos.</p>
<p>Una vez que asignas (o “mapeas”) una estética, ggplot2 se ocupa del resto. El paquete selecciona una escala razonable para usar con la estética elegida y construye una leyenda que explica la relación entre niveles y valores. Para la estética x e y, ggplot2 no crea una leyenda, pero sí una línea que delimita el eje con sus marcas de graduación y una etiqueta. La línea del eje actúa como una leyenda; explica el mapeo entre ubicaciones y valores.</p>
<p>También puedes fijar las propiedades estéticas de tu geom manualmente. Por ejemplo, podemos hacer que todos los puntos del gráfico sean azules:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aquí, el color no transmite información sobre una variable, sino que cambia la apariencia del gráfico. Para establecer una estética de forma manual, debes usar el nombre de la estética como un argumento de la función geom; es decir, va fuera de aes(). Tendrás que elegir un nivel que tenga sentido para esa estética:</p>
<ul>
<li>El nombre de un color como cadena de caracteres.</li>
<li>El tamaño de un punto en mm.</li>
<li>La forma de un punto como un número, tal como se muestra.</li>
</ul>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/shapes-1.png" width="800"></p>
<p></p>
<p>R tiene <strong>25 formas predefinidas</strong> que están identificadas por números. Hay algunas que parecen duplicados: por ejemplo 0, 15 y 22 son todos cuadrados. La diferencia viene de la interacción entre las estéticas color y fill (relleno). <strong>Las formas vacías (0–14)</strong> tienen un borde determinado por color; <strong>las formas sólidas (15–18)</strong> están rellenas con color; <strong>las formas rellenas (21–24)</strong> tienen un borde de color y están rellenas por fill.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué no va bien en este código? ¿Por qué hay puntos que no son azules?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> <span class="st">"blue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><span style="color:blue">- ¿Qué variables en millas son categóricas? ¿Qué variables son continuas? (Pista: escribe ?millas para leer la documentación de ayuda para este conjunto de datos). ¿Cómo puedes ver esta información cuando ejecutas millas?</span></p>
<p><span style="color:blue">- Asigna una variable continua a color, size, y shape. ¿Cómo se comportan estas estéticas de manera diferente para variables categóricas y variables continuas?</span></p>
<p><span style="color:blue">- ¿Qué ocurre si asignas o mapeas la misma variable a múltiples estéticas?</span></p>
<p><span style="color:blue">- ¿Qué hace la estética stroke? ¿Con qué formas trabaja? (Pista: consulta ?geom_point)</span></p>
<p><span style="color:blue">- ¿Qué ocurre si se asigna o mapea una estética a algo diferente del nombre de una variable, como aes(color = cilindrada &lt; 5)?</span></p>
<section id="problemas-comunes" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="problemas-comunes"><span class="header-section-number">6.3.1</span> Problemas comunes</h3>
<p>A medida que empieces a escribir código en R, lo más probable es que te encuentres con problemas. No te preocupes, es lo más común. Hemos estado escribiendo código en R durante años, ¡y todos los días seguimos escribiendo código que no funciona!</p>
<p>Comienza comparando cuidadosamente el código que estás ejecutando con el código en este libro. R es extremadamente exigente y un carácter fuera de lugar puede marcar la diferencia. Asegúrate de que cada ( coincida con un ) y cada ” esté emparejado con otro”. Algunas veces ejecutarás el código y no pasará nada. Comprueba la parte izquierda de tu consola: si es un +, significa que R no cree que hayas escrito una expresión completa y está esperando que la termines. En este caso, normalmente es más fácil comenzar de nuevo desde cero presionando ESCAPE (la tecla esc) para cancelar el procesamiento del comando actual.</p>
<p>Un problema común al crear gráficos con ggplot2 es colocar el + en el lugar equivocado: debe ubicarse al final de la línea, no al inicio. En otras palabras, asegúrate de no haber escrito accidentalmente un código como este:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Si esto no resuelve el problema, prueba con la ayuda. Puedes obtener ayuda sobre cualquier función de R ejecutando ?nombre_de_la_funcion en la consola o seleccionando el nombre de la función y presionando F1 en RStudio. No te preocupes si la ayuda no te parece tan útil, trata entonces de saltar a los ejemplos y buscar un pedazo de código que coincida con lo que intentas hacer.</p>
<p>Si eso no ayuda, lee cuidadosamente el mensaje de error. ¡A veces la respuesta estará oculta allí! Sin embargo, cuando recién comienzas en R, puede que la respuesta esté en el mensaje de error, pero aún no sabes cómo entenderlo. Otra gran herramienta es Google: intenta buscar allí el mensaje de error, ya que es probable que otra persona haya tenido el mismo problema y haya obtenido ayuda en línea.</p>
</section>
</section>
<section id="separar-en-facetas" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="separar-en-facetas"><span class="header-section-number">6.4</span> Separar en facetas</h2>
<p><strong>Una forma de agregar variables adicionales es con las estéticas</strong>. Otra forma particularmente útil para las variables categóricas consiste en <strong>dividir el gráfico en facetas</strong>, es decir, sub-gráficos que muestran cada uno un subconjunto de los datos.</p>
<p>Para separar en facetas un gráfico según una sola variable, utiliza facet_wrap() (del inglés envolver una faceta). El primer argumento de facet_wrap() debería ser una fórmula creada con ~ seguida del nombre de una de las variable (aquí “fórmula” es el nombre de un tipo de estructura en R, no un sinónimo de “ecuación”). La variable que uses en facet_wrap() debe ser categórica.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Para separar en facetas un gráfico según las combinaciones de dos variables</strong>, agrega <strong><code>facet_grid()</code></strong> a tu código del gráfico (grid quiere decir cuadrícula en inglés). El primer argumento de facet_grid() también corresponde a una fórmula. Esta vez, la fórmula debe contener dos nombres de variables separados por un ~.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> cilindros)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Si prefieres no separar en facetas las filas o columnas, remplaza por un . el nombre de alguna de las variables, por ejemplo <strong><code>+ facet_grid(. ~ cilindros)</code></strong>.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué ocurre si intentas separar en facetas una variable continua?</span></p>
<p><span style="color:blue">- ¿Qué significan las celdas vacías que aparecen en el gráfico generado usando <code>facet_grid(traccion ~ cilindros)</code>? ¿Cómo se relacionan con este gráfico?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> traccion, <span class="at">y =</span> cilindros))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue">- ¿Qué grafica el siguiente código? ¿Qué hace . ?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> .)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> cilindros)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue">- Mira de nuevo el primer gráfico en facetas presentado en esta sección:</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue">¿Cuáles son las ventajas de separar en facetas en lugar de aplicar una estética de color? ¿Cuáles son las desventajas? ¿Cómo cambiaría este balance si tuvieras un conjunto de datos más grande?</span></p>
<p><span style="color:blue">- Lee <code>?facet_wrap</code>. ¿Qué hace nrow? ¿Qué hace ncol? ¿Qué otras opciones controlan el diseño de los paneles individuales? ¿Por qué <code>facet_grid()</code> no tiene argumentos nrow y ncol?</span></p>
<p><span style="color:blue">- Cuando usas <code>facet_grid()</code>, generalmente deberías poner la variable con un mayor número de niveles únicos en las columnas. ¿Por qué?</span></p>
</section>
<section id="objetos-geométricos" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="objetos-geométricos"><span class="header-section-number">6.5</span> Objetos geométricos</h2>
<p>¿En qué sentido estos dos gráficos son similares?</p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-1.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-2.png" width="600"></p>
<p></p>
<p>Ambos gráficos contienen las mismas variables x e y, y ambos describen los mismos datos. <strong>Pero los gráficos no son idénticos</strong>. Cada uno utiliza un objeto visual diferente para representar los datos. En la sintaxis de ggplot2, decimos que <strong>usan diferentes geoms</strong>.</p>
<p>Un geom es el objeto geométrico usado para representar datos de forma gráfica. <strong>La gente a menudo llama a los gráficos por el tipo de geom que utiliza</strong>. Por ejemplo, los diagramas de barras usan <strong>geoms de barra (bar)</strong>, los diagramas de líneas usan <strong>geoms de línea (line)</strong>, los diagramas de caja usan <strong>geoms de diagrama de caja (boxplot)</strong>, y así sucesivamente. En inglés, los diagramas de puntos (llamados scatterplots) rompen la tendencia; ellos usan geom de punto (o point). Como vemos arriba, puedes usar diferentes geoms para graficar los mismos datos. La gráfica de arriba usa el geom de <strong>punto (geom_point())</strong>, y la gráfica de abajo usa el <strong>geom suavizado (geom_smooth())</strong>, una línea suavizada ajustada a los datos.</p>
<p>Para cambiar el geom de tu gráfico, modifica la función geom que acompaña a ggplot(). Por ejemplo, para hacer los gráficos que se muestran arriba, puedes usar este código:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arriba</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># abajo</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Cada función geom en ggplot2 toma un argumento de mapping</strong>. Sin embargo, <strong>no todas las estéticas funcionan con todos los geom</strong>. Puedes establecer la forma para un punto, pero no puedes establecer la “forma” de una línea. Por otro lado, para una línea podrías elegir el tipo de línea (linetype). geom_smooth() dibujará una línea diferente, con un tipo de línea distinto (linetype), para cada valor único de la variable que asignes al tipo de línea (linetype).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">linetype =</span> traccion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aquí <strong><code>geom_smooth()</code></strong> separa los automóviles en tres líneas en función de su valor de <strong>traccion</strong>, que describe <strong>el tipo de transmisión de un automóvil</strong>. Una línea describe todos los puntos con un valor de 4, otra línea los de valor d, y una tercera línea describe los puntos con un valor t. Aquí, 4 significa tracción en las cuatro ruedas, d tracción delantera y t tracción trasera.</p>
<p><strong>Si esto suena extraño, podemos hacerlo más claro al superponer las líneas sobre los datos brutos y luego colorear todo según traccion.</strong></p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-22-1.png" width="800"></p>
<p></p>
<p>¡Observa que generamos un gráfico que contiene dos geoms! Si esto te emociona, abróchate el cinturón. En la siguiente sección aprenderemos cómo colocar múltiples geoms en el mismo gráfico.</p>
<p><strong>ggplot2 proporciona más de 40 geoms</strong> y los paquetes de extensión proporcionan aún más (consulta <a href="https://exts.ggplot2.tidyverse.org/gallery/" class="uri">https://exts.ggplot2.tidyverse.org/gallery/</a> para obtener una muestra). La mejor forma de obtener un panorama completo sobre las posibilidades que brinda ggplot2 es consultando la hoja de referencia (o <strong>cheatsheet</strong>), que puedes encontrar en <a href="https://rstudio.com/resources/cheatsheets/" class="uri">https://rstudio.com/resources/cheatsheets/</a> (en la parte baja de la página encontrarás la versión en español). Para obtener más información sobre un tipo dado de geoms, usa la ayuda: <strong><code>?geom_smooth</code></strong>.</p>
<p>Muchos <strong>geoms</strong>, como <strong>geom_smooth()</strong>, usan un único objeto geométrico para mostrar múltiples filas de datos. Con estos geoms, <strong>puedes asignar la estética de group (grupo) a una variable categórica para graficar múltiples objetos</strong>. ggplot2 representará un objeto distinto por cada valor único de la variable de agrupamiento. En la práctica, ggplot2 agrupará automáticamente los datos para estos geoms siempre que se asigne una estética a una variable discreta (como en el ejemplo del tipo de línea o linetype). Es conveniente confiar en esta característica porque la estética del grupo en sí misma no agrega una leyenda o características distintivas a los geoms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">group =</span> traccion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para mostrar múltiples geoms en el mismo gráfico, agrega varias funciones geom a ggplot():</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Esto introduce, sin embargo, cierta <strong>duplicación en nuestro código</strong>. Imagina que <strong>deseas cambiar</strong> el eje <strong>y</strong> para mostrar cilindrada en lugar de autopista. <strong>Necesitarías cambiar la variable en dos lugares y podrías olvidarte de actualizar uno</strong>. Puedes evitar este tipo de repetición <strong>pasando un conjunto de mapeos a <code>ggplot()</code></strong>. ggplot2 tratará estos mapeos como **mapeos globales* que se aplican a cada geom en el gráfico. En otras palabras, este código producirá la misma gráfica que el código anterior:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Si colocas mapeos en una función geom, ggplot2 los tratará como mapeos locales para la capa</strong>. Estas asignaciones serán usadas para extender o sobrescribir los mapeos globales solo para esa capa. Esto permite mostrar diferentes estéticas en diferentes capas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La misma idea se puede emplear para especificar distintos conjuntos de datos (data) para cada capa. En el siguiente caso, nuestra línea suave muestra solo un subconjunto del conjunto de datos de millas: los autos subcompactos. El argumento local de datos en <strong><code>geom_smooth()</code></strong> anula el argumento de datos globales en <code>ggplot()</code> solo para esa capa.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(millas, clase <span class="sc">==</span> <span class="st">"subcompacto"</span>), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Qué geom usarías para generar un gráfico de líneas? ¿Y para un diagrama de caja? ¿Y para un histograma? ¿Y para un gráfico de área?</span></p>
<p><span style="color:blue">- Ejecuta este código en tu mente y predice cómo se verá el output. Luego, ejecuta el código en R y verifica tus predicciones.</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue">- ¿Qué muestra show.legend = FALSE? ¿Qué pasa si lo quitas? ¿Por qué crees que lo utilizamos antes en el capítulo?</span></p>
<p><span style="color:blue">- ¿Qué hace el argumento se en geom_smooth()?</span></p>
<p><span style="color:blue">- ¿Se verán distintos estos gráficos? ¿Por qué sí o por qué no?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span style="color:blue">- Recrea el código R necesario para generar los siguientes gráficos:</span></p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-1.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-2.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-3.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-4.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-5.png" width="600"> <img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-6.png" width="600"></p>
<p></p>
</section>
<section id="transformaciones-estadísticas" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="transformaciones-estadísticas"><span class="header-section-number">6.6</span> Transformaciones estadísticas</h2>
<p>A continuación, echemos un vistazo a un <strong>gráfico de barras</strong>. Los gráficos de barras parecen simples, pero son interesantes porque revelan algo sutil sobre los gráficos. Considera un gráfico de barras básico, como uno realizado con <strong><code>geom_bar()</code></strong>. El siguiente gráfico muestra la cantidad total de diamantes en el <strong>conjunto de datos diamantes</strong>, agrupados por la <strong>variable corte</strong>. El conjunto de datos diamantes se encuentra en el paquete datos y contiene información sobre ~ 54000 diamantes, <strong>incluido el precio, el quilate, el color, la claridad y el corte de cada uno</strong>. El gráfico muestra que hay más diamantes disponibles con cortes de alta calidad que con cortes de baja calidad.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En el eje x, el gráfico muestra <strong>corte</strong>, una variable de diamantes. En el eje y muestra el <strong>recuento (count)</strong>, ¡pero el recuento no es una variable en diamantes! <strong>¿De dónde viene?</strong> Muchos gráficos, como los diagramas de dispersión (scatterplots), grafican los valores brutos de un conjunto de datos. Otros gráficos, como los de barras, calculan nuevos valores para presentar:</p>
<ul>
<li><p>Los gráficos de barras, los histogramas y los polígonos de frecuencia almacenan los datos y luego grafican los conteos por contenedores (bins), es decir, el número de puntos que caen en cada contenedor.</p></li>
<li><p>Los gráficos de líneas suavizadas (smoothers) ajustan un modelo a los datos y luego grafican las predicciones del modelo.</p></li>
<li><p>Los diagramas de caja (boxplots) calculan un resumen robusto de la distribución y luego muestran una caja con formato especial.</p></li>
</ul>
<p>El algoritmo utilizado para calcular nuevos valores para un gráfico se llama <strong>stat</strong>, abreviatura en inglés de transformación estadística (statistical transformation). La siguiente figura describe cómo funciona este proceso con geom_bar().</p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-stat-bar.svg" width="900"></p>
<p></p>
<p>Puedes aprender acerca de qué <strong>stat usa cada geom</strong> inspeccionando el valor predeterminado para el argumento stat. Por ejemplo, <code>?geom_bar</code> muestra que el <strong>valor predeterminado para stat es “count”</strong>, lo que significa que <code>geom_bar()</code> <strong>usa <code>stat_count()</code></strong>. <code>stat_count()</code> está documentado en la misma página que geom_bar() y si te desplazas hacia abajo puedes encontrar una sección llamada “Computed variables” (Variables calculadas). Ahí se describe cómo calcula dos <strong>nuevas variables: count y prop</strong>.</p>
<p>Por lo general, puedes usar geoms y estadísticas de forma intercambiable. Por ejemplo, puedes volver a crear la gráfica anterior usando <strong><code>stat_count()</code></strong> en lugar de <strong><code>geom_bar()</code></strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Esto funciona porque <strong>cada geom tiene una estadística predeterminada y cada estadística tiene un geom predeterminado</strong>. Esto significa que generalmente <strong>puedes usar geoms sin preocuparte por la transformación estadística subyacente</strong>.</p>
<p>Hay tres razones por las que podrías necesitar usar una estadística explícitamente:</p>
<ol type="1">
<li><strong>Es posible que desees anular la estadística predeterminada</strong>. En el siguiente código, cambiamos en geom_bar() la estadística recuento (“count”, el valor predeterminado) a identidad <strong>(“identity”)</strong>. Esto nos permite asignar la altura de las barras a los valores brutos de una variable <strong>y</strong>. Desafortunadamente, cuando las personas hablan de gráficos de barras de manera informal, podrían estar refiriéndose a este tipo de gráfico de barras, en el que la altura de la barra ya está presente en los datos, o bien, al gráfico de barras anterior, en el que la altura de la barra se determina contando filas.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>corte,     <span class="sc">~</span>freq,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Regular"</span>,   <span class="dv">1610</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bueno"</span>,     <span class="dv">4906</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Muy Bueno"</span>, <span class="dv">12082</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Premium"</span>,   <span class="dv">13791</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ideal"</span>,     <span class="dv">21551</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> demo) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> freq), <span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>(No te preocupes si nunca has visto <strong>&lt;-</strong> o <strong>tribble()</strong>. Puede que seas capaz de adivinar su significado por el contexto y ¡pronto aprenderás qué es lo que hacen exactamente!)</p>
<ol start="2" type="1">
<li><strong>Es posible que desees anular el mapeo predeterminado</strong> de las variables transformadas a las estéticas. Por ejemplo, es posible que desees mostrar un gráfico de <strong>barras de proporciones</strong>, en lugar de un recuento:</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">stat</span>(prop), <span class="at">group =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat(prop)` was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(prop)` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para encontrar las variables calculadas por <strong>stat</strong>, busca la sección de ayuda titulada <strong>“Compute Variables”</strong>.</p>
<ol start="3" type="1">
<li>Es posible que desees resaltar la transformación estadística en tu código. Por ejemplo, puedes usar <strong>stat_summary()</strong>, que resume los valores de <strong>y</strong> para cada valor único de x, para así resaltar el resumen que se está computando:</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> profundidad),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.min =</span> min,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.max =</span> max,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> median</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>ggplot2 proporciona más de 20 transformaciones estadísticas para que uses</strong>. Cada <strong>stat</strong> es una función, por lo que puedes obtener ayuda de la manera habitual, por ejemplo: <code>?stat_bin</code>. Para ver una lista completa de transformaciones estadísticas disponibles para ggplot2, consulta la hoja de referencia.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Cuál es el geom predeterminado asociado con stat_summary()? ¿Cómo podrías reescribir el gráfico anterior para usar esa función geom en lugar de la función stat?</span></p>
<p><span style="color:blue">- ¿Qué hace geom_col()? ¿En qué se diferencia de geom_bar()?</span></p>
<p><span style="color:blue">- La mayoría de los geoms y las transformaciones estadísticas vienen en pares que casi siempre se usan en conjunto. Lee la documentación y haz una lista de todos los pares. ¿Qué tienen en común?</span></p>
<p><span style="color:blue">- ¿Qué variables calcula stat_smooth()? ¿Qué parámetros controlan su comportamiento?</span></p>
<p><span style="color:blue">- En nuestro gráfico de barras de proporción necesitamos establecer group = 1. ¿Por qué? En otras palabras, ¿cuál es el problema con estos dos gráficos?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> color, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ajustes-de-posición" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="ajustes-de-posición"><span class="header-section-number">6.7</span> Ajustes de posición</h2>
<p><strong>Hay una pieza más de magia asociada</strong> con los gráficos de barras. Puedes colorear un gráfico de barras usando tanto la estética de color como la <strong>más útil fill</strong> (relleno):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> corte))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Mira lo que sucede si <strong>asignas la estética de relleno (fill) a otra variable</strong>, como claridad: <strong>las barras se apilan automáticamente.</strong> Cada rectángulo de color representa una <strong>combinación de corte y claridad.</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El apilamiento se realiza automáticamente mediante el ajuste de posición especificado por el argumento position. <strong>Si no deseas un gráfico de barras apiladas (“stack”)</strong>, puedes usar una de las otras tres opciones: <strong>“identity”, “dodge” o “fill”</strong>.</p>
<ul>
<li><strong>position = “identity” colocará cada objeto exactamente donde cae en el contexto del gráfico</strong>. Esto no es muy útil al momento de graficar barras, ya que las superpone. Para ver esa superposición, debemos hacer que las barras sean ligeramente transparentes configurando el alpha a un valor pequeño, o completamente transparente al establecer fill = NA.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">position =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> claridad)) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">position =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>El ajuste de <strong>position = identity</strong> es más útil para geoms 2D, como puntos, donde es la opción predeterminada.</p>
<ul>
<li><strong>position = “fill”</strong> funciona como el apilamiento de <strong>position = “stack”</strong>, pero hace que cada conjunto de barras apiladas tenga la misma altura. Esto hace que sea más fácil comparar proporciones entre grupos.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><strong>position = “dodge”</strong> coloca los objetos superpuestos uno al lado del otro. Esto hace que sea más fácil comparar valores individuales.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Hay otro tipo de ajuste que no es útil para gráficos de barras, pero que puede ser muy útil para diagramas de dispersión. Recuerda nuestro primer diagrama de dispersión. <strong>¿Notaste que mostraba solo 126 puntos, a pesar de que hay 234 observaciones en el conjunto de datos?</strong></p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-43-1.png" width="600"></p>
<p></p>
<p>Los valores de las variables <strong>autopista y cilindrada</strong> se redondean de modo que los puntos aparecen en una cuadrícula y <strong>muchos se superponen entre sí</strong>. Este problema se conoce como solapamiento <strong>(overplotting)</strong>. Esta disposición hace que sea difícil ver dónde está la masa de datos. ¿Los puntos de datos se distribuyen equitativamente a lo largo de la gráfica, o hay una combinación especial de autopista y cilindrada que contiene 109 valores?</p>
<p><strong>Puedes evitar esto</strong> estableciendo el ajuste de posición en “jitter”. <strong>position = “jitter”</strong> agrega una pequeña cantidad de ruido aleatorio a cada punto. <strong>Esto dispersa los puntos</strong>, ya que es poco probable que dos puntos reciban la misma cantidad de ruido aleatorio.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">position =</span> <span class="st">"jitter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Agregar aleatoriedad a los puntos puede parecer una forma extraña de mejorar tu gráfico</strong>. Si bien hace que sea menos preciso a escalas pequeñas, lo hace ser más revelador a gran escala. Como esta es una operación tan útil, ggplot2 incluye una abreviatura de geom_point(position = “jitter”): geom_jitter().</p>
<p>Para obtener más información sobre ajustes de posición, busca la página de ayuda asociada con cada ajuste: ?position_dodge, ?position_fill, ?position_identity, ?position_jitter y ?position_stack.</p>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- ¿Cuál es el problema con este gráfico? ¿Cómo podrías mejorarlo?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><span style="color:blue">- ¿Qué parámetros de geom_jitter() controlan la cantidad de ruido?</span></p>
<p><span style="color:blue">- Compara y contrasta geom_jitter() con geom_count()</span></p>
<p><span style="color:blue">- ¿Cuál es el ajuste de posición predeterminado de geom_boxplot()? Crea una visualización del conjunto de datos de millas que lo demuestre.</span></p>
</section>
<section id="sistemas-de-coordenadas" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="sistemas-de-coordenadas"><span class="header-section-number">6.8</span> Sistemas de coordenadas</h2>
<p>Los sistemas de coordenadas son probablemente la parte más complicada de ggplot2. El sistema predeterminado es el sistema de coordenadas cartesianas, donde las posiciones x e y actúan independientemente para determinar la ubicación de cada punto. Hay varios otros sistemas de coordenadas que ocasionalmente son útiles.</p>
<ul>
<li><strong>coord_flip() cambia los ejes x e y</strong>. Esto es útil, por ejemplo, si quieres <strong>diagramas de caja horizontales</strong>. También es útil para etiquetas largas: es difícil ajustarlas sin que se superpongan en el eje x.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><strong>coord_quickmap() establece correctamente la relación de aspecto para los mapas</strong>. Esto es muy importante si graficas datos espaciales con ggplot2 (tema para el que, desafortunadamente, no contamos con espacio para desarrollar en este libro).</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>nz <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"nz"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li><strong>coord_polar() usa coordenadas polares</strong>. Las coordenadas polares revelan una conexión interesante entre un gráfico de barras y un gráfico de Coxcomb.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_polar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><span style="color:blue"><strong>Ejercicios</strong></span></p>
<p><span style="color:blue">- Convierte un gráfico de barras apiladas en un gráfico circular usando coord_polar().</span></p>
<p><span style="color:blue">- ¿Qué hace labs()? Lee la documentación.</span></p>
<p><span style="color:blue">- ¿Cuál es la diferencia entre coord_quickmap() y coord_map()?</span></p>
<p><span style="color:blue">- ¿Qué te dice la gráfica siguiente sobre la relación entre ciudad y autopista? ¿Por qué es coord_fixed() importante? ¿Qué hace geom_abline()?</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c04_tidyverse_3_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="la-gramática-de-gráficos-en-capas" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="la-gramática-de-gráficos-en-capas"><span class="header-section-number">6.9</span> La gramática de gráficos en capas</h2>
<p>En las secciones anteriores aprendiste mucho más que solo hacer diagramas de dispersión, gráficos de barras y diagramas de caja. Aprendiste una base que se puede usar para hacer cualquier tipo de gráfico con ggplot2. Para ver esto, agreguemos ajustes de posición, transformaciones estadísticas, sistemas de coordenadas y facetas a nuestra plantilla de código:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">stat =</span> <span class="sc">&lt;</span>ESTADÍSTICAS<span class="sc">&gt;</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">position =</span> <span class="sc">&lt;</span>POSICIÓN<span class="sc">&gt;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a> ) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_COORDENADAS<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_FACETAS<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Nuestra nueva plantilla tiene siete parámetros que se corresponden con las palabras entre corchetes que aparecen en la plantilla. En la práctica, rara vez necesitas proporcionar los siete parámetros para hacer un gráfico porque ggplot2 proporcionará valores predeterminados útiles para todos, excepto para los datos, el mapeo y la función geom.</p>
<p>Los siete parámetros en la plantilla componen la gramática de los gráficos, un sistema formal de construcción de gráficos. La gramática de los gráficos se basa en la idea de que puedes describir de manera única cualquier gráfico como una combinación de un conjunto de datos, un geom, un conjunto de mapeos, una estadística, un ajuste de posición, un sistema de coordenadas y un esquema de facetado.</p>
<p>Para ver cómo funciona esto, considera cómo podrías construir un gráfico básico desde cero: podrías comenzar con un conjunto de datos y luego transformarlo en la información que deseas mostrar (con un stat).</p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-1.svg" width="900"></p>
<p></p>
<p>A continuación, podrías elegir un objeto geométrico para representar cada observación en los datos transformados. Luego, podrías usar las propiedades estéticas de los geoms para representar variables de los datos. Asignarías los valores de cada variable a los niveles de una estética.</p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-2.svg" width="900"></p>
<p></p>
<p>Posteriormente, podrías seleccionar un sistema de coordenadas para colocar los geoms. Podrías utilizar la ubicación de los objetos (que es en sí misma una propiedad estética) para mostrar los valores de las variables x e y. Ya en este punto podrías tener un gráfico completo, pero también podrías ajustar aún más las posiciones de los geoms dentro del sistema de coordenadas (un ajuste de posición) o dividir el gráfico en facetas. También podrías extender el gráfico agregando una o más capas adicionales, donde cada capa adicional usaría un conjunto de datos, un geom, un conjunto de mapeos, una estadística y un ajuste de posición.</p>
<p align="center">
</p><p><img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-3.svg" width="900"></p>
<p></p>
<p>Puedes usar este método para construir cualquier gráfico que imagines. En otras palabras, puedes usar la plantilla de código que aprendiste en este capítulo para construir cientos de miles de gráficos únicos.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./c04_tidyverse_1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulación de datos con tidyverse</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb69" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Gráficos en R</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>**"Un simple gráfico ha brindado más información a la mente del analista de datos que cualquier otro dispositivo". --- John Tukey**</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>La función <span class="in">`plot()`</span> de R base es una función que permite crear gráficos básicos, como diagramas de dispersión, líneas, histogramas, etc. Permite configurar varios argumentos que se pueden utilizar para personalizar el gráfico, como el tipo de línea, color, tamaño de punto, etc.</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>Por otro lado, la librería <span class="in">`ggplot2`</span> es una librería de visualización de datos en R que permite crear gráficos más complejos y elegantes, utilizando una sintaxis declarativa. ggplot2 se basa en el concepto de capas, lo que significa que se pueden agregar diferentes capas al gráfico para mostrar diferentes aspectos de los datos. Además, también proporciona una amplia gama de herramientas para personalizar los gráficos, incluyendo temas, escalas de colores, etiquetas de ejes y títulos.</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>En este capítulo se explicará cómo visualizar tus datos usando el paquete ggplot2. Para profundizar los fundamentos fundamentos teóricos de ggplot2 antes de comenzar, te recomendamos leer "La gramática de gráficos en capas", <span class="ot">&lt;http://vita.had.co.nz/papers/layered-grammar.pdf&gt;</span>.</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot con R base</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>Aquí haremos algunos ejemplos sobre cómo realizar gráficos sencillos con <span class="in">`plot()`</span> a partir de un dataframe especificando los argumentos x e y.</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) , <span class="dv">100</span> , <span class="at">replace=</span>T),</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">+</span> <span class="fl">0.2</span><span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) , <span class="dv">100</span> , <span class="at">replace=</span>T)</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>data<span class="sc">$</span>x, <span class="at">y=</span>data<span class="sc">$</span>y)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>Aquí mostramos una breve descripción de la personalización más común: - cex: Tamaño de puntos - xlim y ylim: Límites de los ejes X e Y - pch: Forma de los marcadores. Ver todos <span class="co">[</span><span class="ot">aquí</span><span class="co">](https://r-graph-gallery.com/6-graph-parameters-reminder.html)</span>. - xlab y ylab: Etiquetas de los ejes X e Y - col: Color del marcador - main: Título del gráfico</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y,</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250</span>) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">250</span>), </span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">18</span>, </span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="dv">2</span>, </span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"#69b3a2"</span>,</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Valor de X"</span>, <span class="at">ylab=</span><span class="st">"Valor de Y"</span>,</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Un scatterplot simple"</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y,</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"#69b3a2"</span>,</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Valor de X"</span>, <span class="at">ylab=</span><span class="st">"Valor de Y"</span>,</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Un scatterplot simple"</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">pch=</span><span class="st">"*"</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>), <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">cex=</span><span class="fl">0.8</span>,</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">"Leyenda"</span>)</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ahora sí! Ggplot2</span></span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>Esta sección se centra en ggplot2, uno de los paquetes principales de Tidyverse. Lo primero que haremos será comprobar si tenemos instalado <span class="in">`tidyverse`</span> y si no lo tenemos, primero deberás instalarlo y luego ejecutar <span class="in">`library()`</span>:</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>Solo es necesario que instales los paquetes una única vez; sin embargo, tendrás que cargarlos siempre que inicies una nueva sesión.</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>Cuando necesitemos especificar la procedencia de una función (o un conjunto de datos), usaremos el formato especial <span class="in">`paquete::funcion()`</span>. Por ejemplo, <span class="in">`ggplot2::ggplot()`</span> dice explícitamente que estamos usando la función **ggplot()** del paquete **ggplot2**.</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>Además del Tidyverse, es necesario que cargues el paquete datos, ya que en él están contenidas las versiones en español de los datos que utilizaremos en este capítulo:</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("datos")</span></span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datos)</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Primeros pasos</span></span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>En este primer ejercicio usaremos la base de datos <span class="in">`millas`</span>. Simplemente analizando los datos intentaremos responder a las preguntas: ¿los automóviles con motores grandes consumen más combustible que los automóviles con motores pequeños? ¿Cómo es la relación entre el tamaño del motor y la eficiencia del combustible? ¿Es positiva? ¿Es negativa? ¿Es lineal o no lineal?</span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a><span class="fu">### El data frame millas</span></span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>Esta data la podemos cargar con la librería datos, **(datos::millas)**. El data frame **millas** contiene observaciones para 38 modelos de automóviles recopiladas por la Agencia de Protección Ambiental de los EE. UU.</span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a>millas</span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a>Entre las variables de millas se encuentran:</span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**cilindrada:** tamaño del motor del automóvil, en litros.</span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**autopista:** eficiencia del uso de combustible de un automóvil en carretera, en millas por galón. Al recorrer la misma distancia, un automóvil de baja eficiencia consume más combustible que un automóvil de alta eficiencia.</span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a>Para obtener más información sobre el data frame millas, abre su página de ayuda ejecutando <span class="in">`?millas`</span>.</span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creando un gráfico con ggplot</span></span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a>Para graficar **`millas`**, ejecuta este código para poner **`cilindrada`** en el eje x y **`autopista`** en el eje y:</span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-101"><a href="#cb69-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-102"><a href="#cb69-102" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-103"><a href="#cb69-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-104"><a href="#cb69-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-105"><a href="#cb69-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-106"><a href="#cb69-106" aria-hidden="true" tabindex="-1"></a>El gráfico muestra una relación negativa entre el tamaño del motor **(cilindrada)** y la eficiencia del combustible **(autopista)**. En otras palabras, **los vehículos con motores grandes usan más combustible**. Este resultado, ¿confirma o refuta tu hipótesis acerca de la relación entre la eficiencia del combustible y el tamaño del motor?</span>
<span id="cb69-107"><a href="#cb69-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-108"><a href="#cb69-108" aria-hidden="true" tabindex="-1"></a>**Para comenzar un gráfico con ggplot2 se utiliza la función ggplot(). ggplot() crea un sistema de coordenadas al que puedes agregar capas**. El **primer** argumento de ggplot() es el **conjunto de datos** que se utilizará en el gráfico. Si corres ggplot(data = millas), obtendrás un gráfico vacío. Como no es muy interesante, no vamos a mostrarlo aquí.</span>
<span id="cb69-109"><a href="#cb69-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-110"><a href="#cb69-110" aria-hidden="true" tabindex="-1"></a>Para completar tu gráfico debes agregar una o más capas a ggplot(). La función **geom_point()** agrega una capa de puntos al gráfico, lo que crea un **diagrama de dispersión (o scatterplot)**. ggplot2 incluye muchas funciones geom, cada una de las cuales agrega un tipo de capa diferente a un gráfico. Aprenderás muchas de ellas a lo largo de este capítulo.</span>
<span id="cb69-111"><a href="#cb69-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-112"><a href="#cb69-112" aria-hidden="true" tabindex="-1"></a>Cada función geom en ggplot2 tiene un argumento de mapping. Este define cómo se "mapean" o se asignan las variables del conjunto de datos a propiedades visuales. El argumento de mapping siempre aparece emparejado con aes() y los argumentos x e y dentro de aes() especifican qué variables asignar a estos ejes. ggplot2 busca la variable asignada en el argumento data, en este caso, millas.</span>
<span id="cb69-113"><a href="#cb69-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-114"><a href="#cb69-114" aria-hidden="true" tabindex="-1"></a><span class="fu">### Una plantilla de gráficos</span></span>
<span id="cb69-115"><a href="#cb69-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-116"><a href="#cb69-116" aria-hidden="true" tabindex="-1"></a>Convirtamos ahora este código en una plantilla reutilizable para hacer gráficos con ggplot2. Para hacer un gráfico, reemplaza las secciones entre corchetes en el siguiente código con un conjunto de datos, una función geom o una colección de mapeos.</span>
<span id="cb69-117"><a href="#cb69-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-118"><a href="#cb69-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-119"><a href="#cb69-119" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb69-120"><a href="#cb69-120" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>))</span>
<span id="cb69-121"><a href="#cb69-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-122"><a href="#cb69-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-123"><a href="#cb69-123" aria-hidden="true" tabindex="-1"></a>El resto de este capítulo te mostrará cómo utilizar y adaptar esta plantilla para crear diferentes tipos de gráficos. Comenzaremos por el componente **`&lt;MAPEOS&gt;`**</span>
<span id="cb69-124"><a href="#cb69-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-125"><a href="#cb69-125" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Ejercicios**</span><span class="co">]</span>{style="color:blue"}</span>
<span id="cb69-126"><a href="#cb69-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-127"><a href="#cb69-127" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Ejecuta ggplot(data = millas). ¿Qué observas?</span>
<span id="cb69-128"><a href="#cb69-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-129"><a href="#cb69-129" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Cuántas filas hay en millas? ¿Cuántas columnas?</span>
<span id="cb69-130"><a href="#cb69-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-131"><a href="#cb69-131" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué describe la variable traccion? Lee la ayuda de ?millas para encontrar la respuesta.</span>
<span id="cb69-132"><a href="#cb69-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-133"><a href="#cb69-133" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Realiza un gráfico de dispersión de autopista versus cilindros.</span>
<span id="cb69-134"><a href="#cb69-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-135"><a href="#cb69-135" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué sucede cuando haces un gráfico de dispersión (scatterplot) de clase versus traccion? ¿Por qué no es útil este gráfico?</span>
<span id="cb69-136"><a href="#cb69-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-137"><a href="#cb69-137" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mapeos estéticos</span></span>
<span id="cb69-138"><a href="#cb69-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-139"><a href="#cb69-139" aria-hidden="true" tabindex="-1"></a>**"El mayor valor de una imagen es cuando nos obliga a observar lo que no esperábamos ver". --- John Tukey**</span>
<span id="cb69-140"><a href="#cb69-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-141"><a href="#cb69-141" aria-hidden="true" tabindex="-1"></a>En el siguiente gráfico, un grupo de puntos (resaltados en rojo) parece quedar fuera de la tendencia lineal. Estos automóviles tienen un kilometraje mayor de lo que esperaríamos. ¿Cómo puedes explicar estos vehículos?</span>
<span id="cb69-142"><a href="#cb69-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-143"><a href="#cb69-143" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-144"><a href="#cb69-144" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-7-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"500"</span><span class="kw">/&gt;</span></span>
<span id="cb69-145"><a href="#cb69-145" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-146"><a href="#cb69-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-147"><a href="#cb69-147" aria-hidden="true" tabindex="-1"></a>Supongamos que estos automóviles son híbridos. Una forma de probar esta hipótesis es observando la variable que indica la clase de cada automóvil. La variable clase del conjunto de datos de millas clasifica los autos en grupos como compacto, mediano y SUV. Si los puntos periféricos corresponden a automóviles híbridos, deberían estar clasificados como compactos o, tal vez, subcompactos (ten en cuenta que estos datos se recopilaron antes de que las camionetas híbridas y SUV se hicieran populares).</span>
<span id="cb69-148"><a href="#cb69-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-149"><a href="#cb69-149" aria-hidden="true" tabindex="-1"></a>Puedes agregar una tercera variable, como clase, a un diagrama de dispersión bidimensional asignándolo a un parámetro estético. Un parámetro estético (o estética) es una propiedad visual de los objetos de un gráfico. Las estéticas incluye cosas como el tamaño, la forma o el color de tus puntos. Puedes mostrar un punto (como el siguiente) de diferentes maneras si cambias los valores de sus propiedades estéticas. Como ya usamos la palabra "valor" para describir los datos, usemos la palabra "nivel" para describir las propiedades estéticas. Aquí cambiamos los niveles del tamaño, la forma y el color de un punto para que el punto sea pequeño, triangular o azul:</span>
<span id="cb69-150"><a href="#cb69-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-151"><a href="#cb69-151" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-152"><a href="#cb69-152" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-8-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"500"</span><span class="kw">/&gt;</span></span>
<span id="cb69-153"><a href="#cb69-153" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-154"><a href="#cb69-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-155"><a href="#cb69-155" aria-hidden="true" tabindex="-1"></a>El mapeo entre las propiedades estéticas de tu gráfico y las variables de tu dataset te permite comunicar información sobre tus datos. Por ejemplo, puedes asignar los colores de los puntos de acuerdo a la variable clase para indicar a qué clase pertenece cada automóvil.</span>
<span id="cb69-156"><a href="#cb69-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-159"><a href="#cb69-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-160"><a href="#cb69-160" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-161"><a href="#cb69-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> clase))</span>
<span id="cb69-162"><a href="#cb69-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-163"><a href="#cb69-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-164"><a href="#cb69-164" aria-hidden="true" tabindex="-1"></a>(Si prefieres el inglés británico, como Hadley, puedes usar **colour** en lugar de color).</span>
<span id="cb69-165"><a href="#cb69-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-166"><a href="#cb69-166" aria-hidden="true" tabindex="-1"></a>Para mapear (o asignar) una estética a una variable, debes asociar el nombre de la estética al de la variable **dentro de aes()**. ggplot2 **asignará automáticamente un nivel único** de la estética (en este ejemplo, un color) a cada valor único de la variable. **Este proceso es conocido como escalamiento (scaling)**. ggplot2 acompañará el gráfico con una leyenda que explica qué niveles corresponden a qué valores.</span>
<span id="cb69-167"><a href="#cb69-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-168"><a href="#cb69-168" aria-hidden="true" tabindex="-1"></a>Los colores revelan que muchos de los puntos inusuales son automóviles de **dos asientos**. ¡Estos no parecen híbridos y son, de hecho, automóviles deportivos! Los automóviles deportivos tienen motores grandes, como las camionetas todo terreno o pickups, pero su cuerpo es pequeño, como los automóviles medianos y compactos, lo que mejora su consumo de gasolina. En retrospectiva, es poco probable que estos automóviles sean híbridos, ya que tienen motores grandes.</span>
<span id="cb69-169"><a href="#cb69-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-170"><a href="#cb69-170" aria-hidden="true" tabindex="-1"></a>En el ejemplo anterior asignamos la variable clase a la estética de color, pero podríamos haberla asignado a la estética del tamaño del mismo modo. En este caso, **el tamaño exacto de cada punto revelaría a qué clase pertenece**. **Recibimos** aquí una advertencia **(warning)**, porque mapear **una variable no ordenada** (clase) a una estética ordenada (size) **no es una buena idea**.</span>
<span id="cb69-171"><a href="#cb69-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-174"><a href="#cb69-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-175"><a href="#cb69-175" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-176"><a href="#cb69-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">size =</span> clase))</span>
<span id="cb69-177"><a href="#cb69-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-178"><a href="#cb69-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-179"><a href="#cb69-179" aria-hidden="true" tabindex="-1"></a>También podríamos haber asignado la variable clase a la estética **`alpha`**, que controla la **transparencia** de los puntos, o a la estética shape que controla la **forma (shape)** de los puntos.</span>
<span id="cb69-180"><a href="#cb69-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-183"><a href="#cb69-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-184"><a href="#cb69-184" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-185"><a href="#cb69-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">alpha =</span> clase))</span>
<span id="cb69-186"><a href="#cb69-186" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-187"><a href="#cb69-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">shape =</span> clase))</span>
<span id="cb69-188"><a href="#cb69-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-189"><a href="#cb69-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-190"><a href="#cb69-190" aria-hidden="true" tabindex="-1"></a>**¿Qué pasó con los SUV? ggplot2 solo puede usar seis formas a la vez**. **De forma predeterminada**, los grupos adicionales no se grafican cuando se emplea la estética de la forma (shape).</span>
<span id="cb69-191"><a href="#cb69-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-192"><a href="#cb69-192" aria-hidden="true" tabindex="-1"></a>Para cada estética utilizamos aes() para asociar su nombre con la variable seleccionada para graficar. **La función aes() reúne cada una de las asignaciones estéticas utilizadas por una capa y las pasa al argumento de mapeo de la capa**. La sintaxis resalta una visión útil sobre x e y: las ubicaciones de x e y de un punto son en sí mismas también estéticas, es decir propiedades visuales que se puede asignar a las variables para mostrar información sobre los datos.</span>
<span id="cb69-193"><a href="#cb69-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-194"><a href="#cb69-194" aria-hidden="true" tabindex="-1"></a>Una vez que asignas (o "mapeas") una estética, ggplot2 se ocupa del resto. El paquete selecciona una escala razonable para usar con la estética elegida y construye una leyenda que explica la relación entre niveles y valores. Para la estética x e y, ggplot2 no crea una leyenda, pero sí una línea que delimita el eje con sus marcas de graduación y una etiqueta. La línea del eje actúa como una leyenda; explica el mapeo entre ubicaciones y valores.</span>
<span id="cb69-195"><a href="#cb69-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-196"><a href="#cb69-196" aria-hidden="true" tabindex="-1"></a>También puedes fijar las propiedades estéticas de tu geom manualmente. Por ejemplo, podemos hacer que todos los puntos del gráfico sean azules:</span>
<span id="cb69-197"><a href="#cb69-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-200"><a href="#cb69-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-201"><a href="#cb69-201" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-202"><a href="#cb69-202" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb69-203"><a href="#cb69-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-204"><a href="#cb69-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-205"><a href="#cb69-205" aria-hidden="true" tabindex="-1"></a>Aquí, el color no transmite información sobre una variable, sino que cambia la apariencia del gráfico. Para establecer una estética de forma manual, debes usar el nombre de la estética como un argumento de la función geom; es decir, va fuera de aes(). Tendrás que elegir un nivel que tenga sentido para esa estética:</span>
<span id="cb69-206"><a href="#cb69-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-207"><a href="#cb69-207" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>El nombre de un color como cadena de caracteres.</span>
<span id="cb69-208"><a href="#cb69-208" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>El tamaño de un punto en mm.</span>
<span id="cb69-209"><a href="#cb69-209" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>La forma de un punto como un número, tal como se muestra.</span>
<span id="cb69-210"><a href="#cb69-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-211"><a href="#cb69-211" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-212"><a href="#cb69-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-213"><a href="#cb69-213" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/shapes-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"800"</span><span class="kw">/&gt;</span></span>
<span id="cb69-214"><a href="#cb69-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-215"><a href="#cb69-215" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-216"><a href="#cb69-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-217"><a href="#cb69-217" aria-hidden="true" tabindex="-1"></a>R tiene **25 formas predefinidas** que están identificadas por números. Hay algunas que parecen duplicados: por ejemplo 0, 15 y 22 son todos cuadrados. La diferencia viene de la interacción entre las estéticas color y fill (relleno). **Las formas vacías (0--14)** tienen un borde determinado por color; **las formas sólidas (15--18)** están rellenas con color; **las formas rellenas (21--24)** tienen un borde de color y están rellenas por fill.</span>
<span id="cb69-218"><a href="#cb69-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-219"><a href="#cb69-219" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Ejercicios**</span><span class="co">]</span>{style="color:blue"}</span>
<span id="cb69-220"><a href="#cb69-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-221"><a href="#cb69-221" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué no va bien en este código? ¿Por qué hay puntos que no son azules?</span>
<span id="cb69-222"><a href="#cb69-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-225"><a href="#cb69-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-226"><a href="#cb69-226" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-227"><a href="#cb69-227" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> <span class="st">"blue"</span>))</span>
<span id="cb69-228"><a href="#cb69-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-229"><a href="#cb69-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-230"><a href="#cb69-230" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué variables en millas son categóricas? ¿Qué variables son continuas? (Pista: escribe ?millas para leer la documentación de ayuda para este conjunto de datos). ¿Cómo puedes ver esta información cuando ejecutas millas?</span>
<span id="cb69-231"><a href="#cb69-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-232"><a href="#cb69-232" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Asigna una variable continua a color, size, y shape. ¿Cómo se comportan estas estéticas de manera diferente para variables categóricas y variables continuas?</span>
<span id="cb69-233"><a href="#cb69-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-234"><a href="#cb69-234" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué ocurre si asignas o mapeas la misma variable a múltiples estéticas?</span>
<span id="cb69-235"><a href="#cb69-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-236"><a href="#cb69-236" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué hace la estética stroke? ¿Con qué formas trabaja? (Pista: consulta ?geom_point)</span>
<span id="cb69-237"><a href="#cb69-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-238"><a href="#cb69-238" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué ocurre si se asigna o mapea una estética a algo diferente del nombre de una variable, como aes(color = cilindrada <span class="sc">\&lt;</span> 5)?</span>
<span id="cb69-239"><a href="#cb69-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-240"><a href="#cb69-240" aria-hidden="true" tabindex="-1"></a><span class="fu">### Problemas comunes</span></span>
<span id="cb69-241"><a href="#cb69-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-242"><a href="#cb69-242" aria-hidden="true" tabindex="-1"></a>A medida que empieces a escribir código en R, lo más probable es que te encuentres con problemas. No te preocupes, es lo más común. Hemos estado escribiendo código en R durante años, ¡y todos los días seguimos escribiendo código que no funciona!</span>
<span id="cb69-243"><a href="#cb69-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-244"><a href="#cb69-244" aria-hidden="true" tabindex="-1"></a>Comienza comparando cuidadosamente el código que estás ejecutando con el código en este libro. R es extremadamente exigente y un carácter fuera de lugar puede marcar la diferencia. Asegúrate de que cada ( coincida con un ) y cada " esté emparejado con otro". Algunas veces ejecutarás el código y no pasará nada. Comprueba la parte izquierda de tu consola: si es un +, significa que R no cree que hayas escrito una expresión completa y está esperando que la termines. En este caso, normalmente es más fácil comenzar de nuevo desde cero presionando ESCAPE (la tecla esc) para cancelar el procesamiento del comando actual.</span>
<span id="cb69-245"><a href="#cb69-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-246"><a href="#cb69-246" aria-hidden="true" tabindex="-1"></a>Un problema común al crear gráficos con ggplot2 es colocar el + en el lugar equivocado: debe ubicarse al final de la línea, no al inicio. En otras palabras, asegúrate de no haber escrito accidentalmente un código como este:</span>
<span id="cb69-247"><a href="#cb69-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-248"><a href="#cb69-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-249"><a href="#cb69-249" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas)</span>
<span id="cb69-250"><a href="#cb69-250" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-251"><a href="#cb69-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-252"><a href="#cb69-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-253"><a href="#cb69-253" aria-hidden="true" tabindex="-1"></a>Si esto no resuelve el problema, prueba con la ayuda. Puedes obtener ayuda sobre cualquier función de R ejecutando ?nombre_de_la_funcion en la consola o seleccionando el nombre de la función y presionando F1 en RStudio. No te preocupes si la ayuda no te parece tan útil, trata entonces de saltar a los ejemplos y buscar un pedazo de código que coincida con lo que intentas hacer.</span>
<span id="cb69-254"><a href="#cb69-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-255"><a href="#cb69-255" aria-hidden="true" tabindex="-1"></a>Si eso no ayuda, lee cuidadosamente el mensaje de error. ¡A veces la respuesta estará oculta allí! Sin embargo, cuando recién comienzas en R, puede que la respuesta esté en el mensaje de error, pero aún no sabes cómo entenderlo. Otra gran herramienta es Google: intenta buscar allí el mensaje de error, ya que es probable que otra persona haya tenido el mismo problema y haya obtenido ayuda en línea.</span>
<span id="cb69-256"><a href="#cb69-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-257"><a href="#cb69-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## Separar en facetas</span></span>
<span id="cb69-258"><a href="#cb69-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-259"><a href="#cb69-259" aria-hidden="true" tabindex="-1"></a>**Una forma de agregar variables adicionales es con las estéticas**. Otra forma particularmente útil para las variables categóricas consiste en **dividir el gráfico en facetas**, es decir, sub-gráficos que muestran cada uno un subconjunto de los datos.</span>
<span id="cb69-260"><a href="#cb69-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-261"><a href="#cb69-261" aria-hidden="true" tabindex="-1"></a>Para separar en facetas un gráfico según una sola variable, utiliza facet_wrap() (del inglés envolver una faceta). El primer argumento de facet_wrap() debería ser una fórmula creada con \~ seguida del nombre de una de las variable (aquí "fórmula" es el nombre de un tipo de estructura en R, no un sinónimo de "ecuación"). La variable que uses en facet_wrap() debe ser categórica.</span>
<span id="cb69-262"><a href="#cb69-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-265"><a href="#cb69-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-266"><a href="#cb69-266" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-267"><a href="#cb69-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-268"><a href="#cb69-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb69-269"><a href="#cb69-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-270"><a href="#cb69-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-271"><a href="#cb69-271" aria-hidden="true" tabindex="-1"></a>**Para separar en facetas un gráfico según las combinaciones de dos variables**, agrega **`facet_grid()`** a tu código del gráfico (grid quiere decir cuadrícula en inglés). El primer argumento de facet_grid() también corresponde a una fórmula. Esta vez, la fórmula debe contener dos nombres de variables separados por un \~.</span>
<span id="cb69-272"><a href="#cb69-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-275"><a href="#cb69-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-276"><a href="#cb69-276" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-277"><a href="#cb69-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-278"><a href="#cb69-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> cilindros)</span>
<span id="cb69-279"><a href="#cb69-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-280"><a href="#cb69-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-281"><a href="#cb69-281" aria-hidden="true" tabindex="-1"></a>Si prefieres no separar en facetas las filas o columnas, remplaza por un . el nombre de alguna de las variables, por ejemplo **`+ facet_grid(. ~ cilindros)`**.</span>
<span id="cb69-282"><a href="#cb69-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-283"><a href="#cb69-283" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Ejercicios**</span><span class="co">]</span>{style="color:blue"}</span>
<span id="cb69-284"><a href="#cb69-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-285"><a href="#cb69-285" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué ocurre si intentas separar en facetas una variable continua?</span>
<span id="cb69-286"><a href="#cb69-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-287"><a href="#cb69-287" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué significan las celdas vacías que aparecen en el gráfico generado usando <span class="in">`facet_grid(traccion ~ cilindros)`</span>? ¿Cómo se relacionan con este gráfico?</span>
<span id="cb69-288"><a href="#cb69-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-289"><a href="#cb69-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-290"><a href="#cb69-290" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-291"><a href="#cb69-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> traccion, <span class="at">y =</span> cilindros))</span>
<span id="cb69-292"><a href="#cb69-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-293"><a href="#cb69-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-294"><a href="#cb69-294" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué grafica el siguiente código? ¿Qué hace . ?</span>
<span id="cb69-295"><a href="#cb69-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-296"><a href="#cb69-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-297"><a href="#cb69-297" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-298"><a href="#cb69-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-299"><a href="#cb69-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(traccion <span class="sc">~</span> .)</span>
<span id="cb69-300"><a href="#cb69-300" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-301"><a href="#cb69-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-302"><a href="#cb69-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> cilindros)</span>
<span id="cb69-303"><a href="#cb69-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-304"><a href="#cb69-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-305"><a href="#cb69-305" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Mira de nuevo el primer gráfico en facetas presentado en esta sección:</span>
<span id="cb69-306"><a href="#cb69-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-307"><a href="#cb69-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-308"><a href="#cb69-308" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-309"><a href="#cb69-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-310"><a href="#cb69-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> clase, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb69-311"><a href="#cb69-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-312"><a href="#cb69-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-313"><a href="#cb69-313" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>¿Cuáles son las ventajas de separar en facetas en lugar de aplicar una estética de color? ¿Cuáles son las desventajas? ¿Cómo cambiaría este balance si tuvieras un conjunto de datos más grande?</span>
<span id="cb69-314"><a href="#cb69-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-315"><a href="#cb69-315" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Lee <span class="in">`?facet_wrap`</span>. ¿Qué hace nrow? ¿Qué hace ncol? ¿Qué otras opciones controlan el diseño de los paneles individuales? ¿Por qué <span class="in">`facet_grid()`</span> no tiene argumentos nrow y ncol?</span>
<span id="cb69-316"><a href="#cb69-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-317"><a href="#cb69-317" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Cuando usas <span class="in">`facet_grid()`</span>, generalmente deberías poner la variable con un mayor número de niveles únicos en las columnas. ¿Por qué?</span>
<span id="cb69-318"><a href="#cb69-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-319"><a href="#cb69-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objetos geométricos</span></span>
<span id="cb69-320"><a href="#cb69-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-321"><a href="#cb69-321" aria-hidden="true" tabindex="-1"></a>¿En qué sentido estos dos gráficos son similares?</span>
<span id="cb69-322"><a href="#cb69-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-323"><a href="#cb69-323" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-324"><a href="#cb69-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-325"><a href="#cb69-325" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-19-2.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span></span>
<span id="cb69-326"><a href="#cb69-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-327"><a href="#cb69-327" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-328"><a href="#cb69-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-329"><a href="#cb69-329" aria-hidden="true" tabindex="-1"></a>Ambos gráficos contienen las mismas variables x e y, y ambos describen los mismos datos. **Pero los gráficos no son idénticos**. Cada uno utiliza un objeto visual diferente para representar los datos. En la sintaxis de ggplot2, decimos que **usan diferentes geoms**.</span>
<span id="cb69-330"><a href="#cb69-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-331"><a href="#cb69-331" aria-hidden="true" tabindex="-1"></a>Un geom es el objeto geométrico usado para representar datos de forma gráfica. **La gente a menudo llama a los gráficos por el tipo de geom que utiliza**. Por ejemplo, los diagramas de barras usan **geoms de barra (bar)**, los diagramas de líneas usan **geoms de línea (line)**, los diagramas de caja usan **geoms de diagrama de caja (boxplot)**, y así sucesivamente. En inglés, los diagramas de puntos (llamados scatterplots) rompen la tendencia; ellos usan geom de punto (o point). Como vemos arriba, puedes usar diferentes geoms para graficar los mismos datos. La gráfica de arriba usa el geom de **punto (geom_point())**, y la gráfica de abajo usa el **geom suavizado (geom_smooth())**, una línea suavizada ajustada a los datos.</span>
<span id="cb69-332"><a href="#cb69-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-333"><a href="#cb69-333" aria-hidden="true" tabindex="-1"></a>Para cambiar el geom de tu gráfico, modifica la función geom que acompaña a ggplot(). Por ejemplo, para hacer los gráficos que se muestran arriba, puedes usar este código:</span>
<span id="cb69-334"><a href="#cb69-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-335"><a href="#cb69-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-336"><a href="#cb69-336" aria-hidden="true" tabindex="-1"></a><span class="co"># arriba</span></span>
<span id="cb69-337"><a href="#cb69-337" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-338"><a href="#cb69-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-339"><a href="#cb69-339" aria-hidden="true" tabindex="-1"></a><span class="co"># abajo</span></span>
<span id="cb69-340"><a href="#cb69-340" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-341"><a href="#cb69-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-342"><a href="#cb69-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-343"><a href="#cb69-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-344"><a href="#cb69-344" aria-hidden="true" tabindex="-1"></a>**Cada función geom en ggplot2 toma un argumento de mapping**. Sin embargo, **no todas las estéticas funcionan con todos los geom**. Puedes establecer la forma para un punto, pero no puedes establecer la "forma" de una línea. Por otro lado, para una línea podrías elegir el tipo de línea (linetype). geom_smooth() dibujará una línea diferente, con un tipo de línea distinto (linetype), para cada valor único de la variable que asignes al tipo de línea (linetype).</span>
<span id="cb69-345"><a href="#cb69-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-348"><a href="#cb69-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-349"><a href="#cb69-349" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-350"><a href="#cb69-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">linetype =</span> traccion))</span>
<span id="cb69-351"><a href="#cb69-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-352"><a href="#cb69-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-353"><a href="#cb69-353" aria-hidden="true" tabindex="-1"></a>Aquí **`geom_smooth()`** separa los automóviles en tres líneas en función de su valor de **traccion**, que describe **el tipo de transmisión de un automóvil**. Una línea describe todos los puntos con un valor de 4, otra línea los de valor d, y una tercera línea describe los puntos con un valor t. Aquí, 4 significa tracción en las cuatro ruedas, d tracción delantera y t tracción trasera.</span>
<span id="cb69-354"><a href="#cb69-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-355"><a href="#cb69-355" aria-hidden="true" tabindex="-1"></a>**Si esto suena extraño, podemos hacerlo más claro al superponer las líneas sobre los datos brutos y luego colorear todo según traccion.**</span>
<span id="cb69-356"><a href="#cb69-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-357"><a href="#cb69-357" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-358"><a href="#cb69-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-359"><a href="#cb69-359" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-22-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"800"</span><span class="kw">/&gt;</span></span>
<span id="cb69-360"><a href="#cb69-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-361"><a href="#cb69-361" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-362"><a href="#cb69-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-363"><a href="#cb69-363" aria-hidden="true" tabindex="-1"></a>¡Observa que generamos un gráfico que contiene dos geoms! Si esto te emociona, abróchate el cinturón. En la siguiente sección aprenderemos cómo colocar múltiples geoms en el mismo gráfico.</span>
<span id="cb69-364"><a href="#cb69-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-365"><a href="#cb69-365" aria-hidden="true" tabindex="-1"></a>**ggplot2 proporciona más de 40 geoms** y los paquetes de extensión proporcionan aún más (consulta &lt;https://exts.ggplot2.tidyverse.org/gallery/&gt; para obtener una muestra). La mejor forma de obtener un panorama completo sobre las posibilidades que brinda ggplot2 es consultando la hoja de referencia (o **cheatsheet**), que puedes encontrar en &lt;https://rstudio.com/resources/cheatsheets/&gt; (en la parte baja de la página encontrarás la versión en español). Para obtener más información sobre un tipo dado de geoms, usa la ayuda: **`?geom_smooth`**.</span>
<span id="cb69-366"><a href="#cb69-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-367"><a href="#cb69-367" aria-hidden="true" tabindex="-1"></a>Muchos **geoms**, como **geom_smooth()**, usan un único objeto geométrico para mostrar múltiples filas de datos. Con estos geoms, **puedes asignar la estética de group (grupo) a una variable categórica para graficar múltiples objetos**. ggplot2 representará un objeto distinto por cada valor único de la variable de agrupamiento. En la práctica, ggplot2 agrupará automáticamente los datos para estos geoms siempre que se asigne una estética a una variable discreta (como en el ejemplo del tipo de línea o linetype). Es conveniente confiar en esta característica porque la estética del grupo en sí misma no agrega una leyenda o características distintivas a los geoms.</span>
<span id="cb69-368"><a href="#cb69-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-371"><a href="#cb69-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-372"><a href="#cb69-372" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-373"><a href="#cb69-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-374"><a href="#cb69-374" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-375"><a href="#cb69-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">group =</span> traccion))</span>
<span id="cb69-376"><a href="#cb69-376" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-377"><a href="#cb69-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb69-378"><a href="#cb69-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion),</span>
<span id="cb69-379"><a href="#cb69-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb69-380"><a href="#cb69-380" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-381"><a href="#cb69-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-382"><a href="#cb69-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-383"><a href="#cb69-383" aria-hidden="true" tabindex="-1"></a>Para mostrar múltiples geoms en el mismo gráfico, agrega varias funciones geom a ggplot():</span>
<span id="cb69-384"><a href="#cb69-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-387"><a href="#cb69-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-388"><a href="#cb69-388" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-389"><a href="#cb69-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-390"><a href="#cb69-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-391"><a href="#cb69-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-392"><a href="#cb69-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-393"><a href="#cb69-393" aria-hidden="true" tabindex="-1"></a>Esto introduce, sin embargo, cierta **duplicación en nuestro código**. Imagina que **deseas cambiar** el eje **y** para mostrar cilindrada en lugar de autopista. **Necesitarías cambiar la variable en dos lugares y podrías olvidarte de actualizar uno**. Puedes evitar este tipo de repetición **pasando un conjunto de mapeos a `ggplot()`**. ggplot2 tratará estos mapeos como <span class="sc">\*\*</span>mapeos globales<span class="sc">\*</span> que se aplican a cada geom en el gráfico. En otras palabras, este código producirá la misma gráfica que el código anterior:</span>
<span id="cb69-394"><a href="#cb69-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-397"><a href="#cb69-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-398"><a href="#cb69-398" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-399"><a href="#cb69-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-400"><a href="#cb69-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb69-401"><a href="#cb69-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-402"><a href="#cb69-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-403"><a href="#cb69-403" aria-hidden="true" tabindex="-1"></a>**Si colocas mapeos en una función geom, ggplot2 los tratará como mapeos locales para la capa**. Estas asignaciones serán usadas para extender o sobrescribir los mapeos globales solo para esa capa. Esto permite mostrar diferentes estéticas en diferentes capas.</span>
<span id="cb69-404"><a href="#cb69-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-407"><a href="#cb69-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-408"><a href="#cb69-408" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-409"><a href="#cb69-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb69-410"><a href="#cb69-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb69-411"><a href="#cb69-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-412"><a href="#cb69-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-413"><a href="#cb69-413" aria-hidden="true" tabindex="-1"></a>La misma idea se puede emplear para especificar distintos conjuntos de datos (data) para cada capa. En el siguiente caso, nuestra línea suave muestra solo un subconjunto del conjunto de datos de millas: los autos subcompactos. El argumento local de datos en **`geom_smooth()`** anula el argumento de datos globales en <span class="in">`ggplot()`</span> solo para esa capa.</span>
<span id="cb69-414"><a href="#cb69-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-417"><a href="#cb69-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-418"><a href="#cb69-418" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-419"><a href="#cb69-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> clase)) <span class="sc">+</span></span>
<span id="cb69-420"><a href="#cb69-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(millas, clase <span class="sc">==</span> <span class="st">"subcompacto"</span>), <span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-421"><a href="#cb69-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-422"><a href="#cb69-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-423"><a href="#cb69-423" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Ejercicios**</span><span class="co">]</span>{style="color:blue"}</span>
<span id="cb69-424"><a href="#cb69-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-425"><a href="#cb69-425" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué geom usarías para generar un gráfico de líneas? ¿Y para un diagrama de caja? ¿Y para un histograma? ¿Y para un gráfico de área?</span>
<span id="cb69-426"><a href="#cb69-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-427"><a href="#cb69-427" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Ejecuta este código en tu mente y predice cómo se verá el output. Luego, ejecuta el código en R y verifica tus predicciones.</span>
<span id="cb69-428"><a href="#cb69-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-429"><a href="#cb69-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-430"><a href="#cb69-430" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista, <span class="at">color =</span> traccion)) <span class="sc">+</span></span>
<span id="cb69-431"><a href="#cb69-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-432"><a href="#cb69-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-433"><a href="#cb69-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-434"><a href="#cb69-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-435"><a href="#cb69-435" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué muestra show.legend = FALSE? ¿Qué pasa si lo quitas? ¿Por qué crees que lo utilizamos antes en el capítulo?</span>
<span id="cb69-436"><a href="#cb69-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-437"><a href="#cb69-437" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué hace el argumento se en geom_smooth()?</span>
<span id="cb69-438"><a href="#cb69-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-439"><a href="#cb69-439" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Se verán distintos estos gráficos? ¿Por qué sí o por qué no?</span>
<span id="cb69-440"><a href="#cb69-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-441"><a href="#cb69-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-442"><a href="#cb69-442" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-443"><a href="#cb69-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-444"><a href="#cb69-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb69-445"><a href="#cb69-445" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-446"><a href="#cb69-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-447"><a href="#cb69-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista))</span>
<span id="cb69-448"><a href="#cb69-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-449"><a href="#cb69-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-450"><a href="#cb69-450" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- Recrea el código R necesario para generar los siguientes gráficos:</span>
<span id="cb69-451"><a href="#cb69-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-452"><a href="#cb69-452" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-453"><a href="#cb69-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-454"><a href="#cb69-454" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-1.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-2.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-3.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-4.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-5.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span> <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-30-6.png"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"600"</span><span class="kw">/&gt;</span></span>
<span id="cb69-455"><a href="#cb69-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-456"><a href="#cb69-456" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-457"><a href="#cb69-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-458"><a href="#cb69-458" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transformaciones estadísticas</span></span>
<span id="cb69-459"><a href="#cb69-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-460"><a href="#cb69-460" aria-hidden="true" tabindex="-1"></a>A continuación, echemos un vistazo a un **gráfico de barras**. Los gráficos de barras parecen simples, pero son interesantes porque revelan algo sutil sobre los gráficos. Considera un gráfico de barras básico, como uno realizado con **`geom_bar()`**. El siguiente gráfico muestra la cantidad total de diamantes en el **conjunto de datos diamantes**, agrupados por la **variable corte**. El conjunto de datos diamantes se encuentra en el paquete datos y contiene información sobre \~ 54000 diamantes, **incluido el precio, el quilate, el color, la claridad y el corte de cada uno**. El gráfico muestra que hay más diamantes disponibles con cortes de alta calidad que con cortes de baja calidad.</span>
<span id="cb69-461"><a href="#cb69-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-464"><a href="#cb69-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-465"><a href="#cb69-465" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-466"><a href="#cb69-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span>
<span id="cb69-467"><a href="#cb69-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-468"><a href="#cb69-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-469"><a href="#cb69-469" aria-hidden="true" tabindex="-1"></a>En el eje x, el gráfico muestra **corte**, una variable de diamantes. En el eje y muestra el **recuento (count)**, ¡pero el recuento no es una variable en diamantes! **¿De dónde viene?** Muchos gráficos, como los diagramas de dispersión (scatterplots), grafican los valores brutos de un conjunto de datos. Otros gráficos, como los de barras, calculan nuevos valores para presentar:</span>
<span id="cb69-470"><a href="#cb69-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-471"><a href="#cb69-471" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Los gráficos de barras, los histogramas y los polígonos de frecuencia almacenan los datos y luego grafican los conteos por contenedores (bins), es decir, el número de puntos que caen en cada contenedor.</span>
<span id="cb69-472"><a href="#cb69-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-473"><a href="#cb69-473" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Los gráficos de líneas suavizadas (smoothers) ajustan un modelo a los datos y luego grafican las predicciones del modelo.</span>
<span id="cb69-474"><a href="#cb69-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-475"><a href="#cb69-475" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Los diagramas de caja (boxplots) calculan un resumen robusto de la distribución y luego muestran una caja con formato especial.</span>
<span id="cb69-476"><a href="#cb69-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-477"><a href="#cb69-477" aria-hidden="true" tabindex="-1"></a>El algoritmo utilizado para calcular nuevos valores para un gráfico se llama **stat**, abreviatura en inglés de transformación estadística (statistical transformation). La siguiente figura describe cómo funciona este proceso con geom_bar().</span>
<span id="cb69-478"><a href="#cb69-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-479"><a href="#cb69-479" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p</span> <span class="er">align</span><span class="ot">=</span><span class="st">"center"</span><span class="kw">&gt;</span></span>
<span id="cb69-480"><a href="#cb69-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-481"><a href="#cb69-481" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-stat-bar.svg"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"900"</span><span class="kw">/&gt;</span></span>
<span id="cb69-482"><a href="#cb69-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-483"><a href="#cb69-483" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/p&gt;</span></span>
<span id="cb69-484"><a href="#cb69-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-485"><a href="#cb69-485" aria-hidden="true" tabindex="-1"></a>Puedes aprender acerca de qué **stat usa cada geom** inspeccionando el valor predeterminado para el argumento stat. Por ejemplo, `?geom_bar` muestra que el **valor predeterminado para stat es "count"**, lo que significa que `geom_bar()` **usa `stat_count()`**. `stat_count()` está documentado en la misma página que geom_bar() y si te desplazas hacia abajo puedes encontrar una sección llamada "Computed variables" (Variables calculadas). Ahí se describe cómo calcula dos **nuevas variables: count y prop**.</span>
<span id="cb69-486"><a href="#cb69-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-487"><a href="#cb69-487" aria-hidden="true" tabindex="-1"></a>Por lo general, puedes usar geoms y estadísticas de forma intercambiable. Por ejemplo, puedes volver a crear la gráfica anterior usando **`stat_count()`** en lugar de **`geom_bar()`**:</span>
<span id="cb69-488"><a href="#cb69-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-491"><a href="#cb69-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-492"><a href="#cb69-492" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-493"><a href="#cb69-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte))</span>
<span id="cb69-494"><a href="#cb69-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-495"><a href="#cb69-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-496"><a href="#cb69-496" aria-hidden="true" tabindex="-1"></a>Esto funciona porque **cada geom tiene una estadística predeterminada y cada estadística tiene un geom predeterminado**. Esto significa que generalmente **puedes usar geoms sin preocuparte por la transformación estadística subyacente**.</span>
<span id="cb69-497"><a href="#cb69-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-498"><a href="#cb69-498" aria-hidden="true" tabindex="-1"></a>Hay tres razones por las que podrías necesitar usar una estadística explícitamente:</span>
<span id="cb69-499"><a href="#cb69-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-500"><a href="#cb69-500" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Es posible que desees anular la estadística predeterminada**. En el siguiente código, cambiamos en geom_bar() la estadística recuento ("count", el valor predeterminado) a identidad **("identity")**. Esto nos permite asignar la altura de las barras a los valores brutos de una variable **y**. Desafortunadamente, cuando las personas hablan de gráficos de barras de manera informal, podrían estar refiriéndose a este tipo de gráfico de barras, en el que la altura de la barra ya está presente en los datos, o bien, al gráfico de barras anterior, en el que la altura de la barra se determina contando filas.</span>
<span id="cb69-501"><a href="#cb69-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-504"><a href="#cb69-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-505"><a href="#cb69-505" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb69-506"><a href="#cb69-506" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>corte,     <span class="sc">~</span>freq,</span>
<span id="cb69-507"><a href="#cb69-507" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Regular"</span>,   <span class="dv">1610</span>,</span>
<span id="cb69-508"><a href="#cb69-508" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bueno"</span>,     <span class="dv">4906</span>,</span>
<span id="cb69-509"><a href="#cb69-509" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Muy Bueno"</span>, <span class="dv">12082</span>,</span>
<span id="cb69-510"><a href="#cb69-510" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Premium"</span>,   <span class="dv">13791</span>,</span>
<span id="cb69-511"><a href="#cb69-511" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ideal"</span>,     <span class="dv">21551</span></span>
<span id="cb69-512"><a href="#cb69-512" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-513"><a href="#cb69-513" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> demo) <span class="sc">+</span></span>
<span id="cb69-514"><a href="#cb69-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> freq), <span class="at">stat =</span> <span class="st">"identity"</span>)</span>
<span id="cb69-515"><a href="#cb69-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-516"><a href="#cb69-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-517"><a href="#cb69-517" aria-hidden="true" tabindex="-1"></a>(No te preocupes si nunca has visto **\&lt;-** o **tribble()**. Puede que seas capaz de adivinar su significado por el contexto y ¡pronto aprenderás qué es lo que hacen exactamente!)</span>
<span id="cb69-518"><a href="#cb69-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-519"><a href="#cb69-519" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Es posible que desees anular el mapeo predeterminado** de las variables transformadas a las estéticas. Por ejemplo, es posible que desees mostrar un gráfico de **barras de proporciones**, en lugar de un recuento:</span>
<span id="cb69-520"><a href="#cb69-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-523"><a href="#cb69-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-524"><a href="#cb69-524" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-525"><a href="#cb69-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">stat</span>(prop), <span class="at">group =</span> <span class="dv">1</span>))</span>
<span id="cb69-526"><a href="#cb69-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-527"><a href="#cb69-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-528"><a href="#cb69-528" aria-hidden="true" tabindex="-1"></a>Para encontrar las variables calculadas por **stat**, busca la sección de ayuda titulada **"Compute Variables"**.</span>
<span id="cb69-529"><a href="#cb69-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-530"><a href="#cb69-530" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Es posible que desees resaltar la transformación estadística en tu código. Por ejemplo, puedes usar **stat_summary()**, que resume los valores de **y** para cada valor único de x, para así resaltar el resumen que se está computando:</span>
<span id="cb69-531"><a href="#cb69-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-534"><a href="#cb69-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-535"><a href="#cb69-535" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-536"><a href="#cb69-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb69-537"><a href="#cb69-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> profundidad),</span>
<span id="cb69-538"><a href="#cb69-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.min =</span> min,</span>
<span id="cb69-539"><a href="#cb69-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.max =</span> max,</span>
<span id="cb69-540"><a href="#cb69-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> median</span>
<span id="cb69-541"><a href="#cb69-541" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-542"><a href="#cb69-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-543"><a href="#cb69-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-544"><a href="#cb69-544" aria-hidden="true" tabindex="-1"></a>**ggplot2 proporciona más de 20 transformaciones estadísticas para que uses**. Cada **stat** es una función, por lo que puedes obtener ayuda de la manera habitual, por ejemplo: <span class="in">`?stat_bin`</span>. Para ver una lista completa de transformaciones estadísticas disponibles para ggplot2, consulta la hoja de referencia.</span>
<span id="cb69-545"><a href="#cb69-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-546"><a href="#cb69-546" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Ejercicios**</span><span class="co">]</span>{style="color:blue"}</span>
<span id="cb69-547"><a href="#cb69-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-548"><a href="#cb69-548" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Cuál es el geom predeterminado asociado con stat_summary()? ¿Cómo podrías reescribir el gráfico anterior para usar esa función geom en lugar de la función stat?</span>
<span id="cb69-549"><a href="#cb69-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-550"><a href="#cb69-550" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué hace geom_col()? ¿En qué se diferencia de geom_bar()?</span>
<span id="cb69-551"><a href="#cb69-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-552"><a href="#cb69-552" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- La mayoría de los geoms y las transformaciones estadísticas vienen en pares que casi siempre se usan en conjunto. Lee la documentación y haz una lista de todos los pares. ¿Qué tienen en común?</span>
<span id="cb69-553"><a href="#cb69-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-554"><a href="#cb69-554" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- ¿Qué variables calcula stat_smooth()? ¿Qué parámetros controlan su comportamiento?</span>
<span id="cb69-555"><a href="#cb69-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-556"><a href="#cb69-556" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:blue"</span><span class="kw">&gt;</span>- En nuestro gráfico de barras de proporción necesitamos establecer group = 1. ¿Por qué? En otras palabras, ¿cuál es el problema con estos dos gráficos?</span>
<span id="cb69-557"><a href="#cb69-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-558"><a href="#cb69-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, include=TRUE}</span></span>
<span id="cb69-559"><a href="#cb69-559" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-560"><a href="#cb69-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span>
<span id="cb69-561"><a href="#cb69-561" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-562"><a href="#cb69-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> color, <span class="at">y =</span> <span class="fu">after_stat</span>(prop))</span>
<span id="cb69-563"><a href="#cb69-563" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-564"><a href="#cb69-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-565"><a href="#cb69-565" aria-hidden="true" tabindex="-1"></a><span class="at">## Ajustes de posición</span></span>
<span id="cb69-566"><a href="#cb69-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-567"><a href="#cb69-567" aria-hidden="true" tabindex="-1"></a><span class="at">**Hay una pieza más de magia asociada** con los gráficos de barras. Puedes colorear un gráfico de barras usando tanto la estética de color como la **más útil fill** (relleno):</span></span>
<span id="cb69-568"><a href="#cb69-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-571"><a href="#cb69-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-572"><a href="#cb69-572" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-573"><a href="#cb69-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> corte))</span>
<span id="cb69-574"><a href="#cb69-574" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-575"><a href="#cb69-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte))</span>
<span id="cb69-576"><a href="#cb69-576" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-577"><a href="#cb69-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-578"><a href="#cb69-578" aria-hidden="true" tabindex="-1"></a><span class="at">Mira lo que sucede si **asignas la estética de relleno (fill) a otra variable**, como claridad: **las barras se apilan automáticamente.** Cada rectángulo de color representa una **combinación de corte y claridad.**</span></span>
<span id="cb69-579"><a href="#cb69-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-582"><a href="#cb69-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-583"><a href="#cb69-583" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-584"><a href="#cb69-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad))</span>
<span id="cb69-585"><a href="#cb69-585" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-586"><a href="#cb69-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-587"><a href="#cb69-587" aria-hidden="true" tabindex="-1"></a><span class="at">El apilamiento se realiza automáticamente mediante el ajuste de posición especificado por el argumento position. **Si no deseas un gráfico de barras apiladas ("stack")**, puedes usar una de las otras tres opciones: **"identity", "dodge" o "fill"**.</span></span>
<span id="cb69-588"><a href="#cb69-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-589"><a href="#cb69-589" aria-hidden="true" tabindex="-1"></a><span class="at">-   **position = "identity" colocará cada objeto exactamente donde cae en el contexto del gráfico**. Esto no es muy útil al momento de graficar barras, ya que las superpone. Para ver esa superposición, debemos hacer que las barras sean ligeramente transparentes configurando el alpha a un valor pequeño, o completamente transparente al establecer fill = NA.</span></span>
<span id="cb69-590"><a href="#cb69-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-593"><a href="#cb69-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-594"><a href="#cb69-594" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad)) <span class="sc">+</span></span>
<span id="cb69-595"><a href="#cb69-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">position =</span> <span class="st">"identity"</span>)</span>
<span id="cb69-596"><a href="#cb69-596" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">colour =</span> claridad)) <span class="sc">+</span></span>
<span id="cb69-597"><a href="#cb69-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">position =</span> <span class="st">"identity"</span>)</span>
<span id="cb69-598"><a href="#cb69-598" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-599"><a href="#cb69-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-600"><a href="#cb69-600" aria-hidden="true" tabindex="-1"></a><span class="at">El ajuste de **position = identity** es más útil para geoms 2D, como puntos, donde es la opción predeterminada.</span></span>
<span id="cb69-601"><a href="#cb69-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-602"><a href="#cb69-602" aria-hidden="true" tabindex="-1"></a><span class="at">-   **position = "fill"** funciona como el apilamiento de **position = "stack"**, pero hace que cada conjunto de barras apiladas tenga la misma altura. Esto hace que sea más fácil comparar proporciones entre grupos.</span></span>
<span id="cb69-603"><a href="#cb69-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-606"><a href="#cb69-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-607"><a href="#cb69-607" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-608"><a href="#cb69-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">"fill"</span>)</span>
<span id="cb69-609"><a href="#cb69-609" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-610"><a href="#cb69-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-611"><a href="#cb69-611" aria-hidden="true" tabindex="-1"></a><span class="at">-   **position = "dodge"** coloca los objetos superpuestos uno al lado del otro. Esto hace que sea más fácil comparar valores individuales.</span></span>
<span id="cb69-612"><a href="#cb69-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-615"><a href="#cb69-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-616"><a href="#cb69-616" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-617"><a href="#cb69-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> claridad), <span class="at">position =</span> <span class="st">"dodge"</span>)</span>
<span id="cb69-618"><a href="#cb69-618" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-619"><a href="#cb69-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-620"><a href="#cb69-620" aria-hidden="true" tabindex="-1"></a><span class="at">Hay otro tipo de ajuste que no es útil para gráficos de barras, pero que puede ser muy útil para diagramas de dispersión. Recuerda nuestro primer diagrama de dispersión. **¿Notaste que mostraba solo 126 puntos, a pesar de que hay 234 observaciones en el conjunto de datos?**</span></span>
<span id="cb69-621"><a href="#cb69-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-622"><a href="#cb69-622" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;p align="center"&gt;</span></span>
<span id="cb69-623"><a href="#cb69-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-624"><a href="#cb69-624" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;img src="https://es.r4ds.hadley.nz/03-visualize_files/figure-html/unnamed-chunk-43-1.png" width="600"/&gt;</span></span>
<span id="cb69-625"><a href="#cb69-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-626"><a href="#cb69-626" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;/p&gt;</span></span>
<span id="cb69-627"><a href="#cb69-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-628"><a href="#cb69-628" aria-hidden="true" tabindex="-1"></a><span class="at">Los valores de las variables **autopista y cilindrada** se redondean de modo que los puntos aparecen en una cuadrícula y **muchos se superponen entre sí**. Este problema se conoce como solapamiento **(overplotting)**. Esta disposición hace que sea difícil ver dónde está la masa de datos. ¿Los puntos de datos se distribuyen equitativamente a lo largo de la gráfica, o hay una combinación especial de autopista y cilindrada que contiene 109 valores?</span></span>
<span id="cb69-629"><a href="#cb69-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-630"><a href="#cb69-630" aria-hidden="true" tabindex="-1"></a><span class="at">**Puedes evitar esto** estableciendo el ajuste de posición en "jitter". **position = "jitter"** agrega una pequeña cantidad de ruido aleatorio a cada punto. **Esto dispersa los puntos**, ya que es poco probable que dos puntos reciban la misma cantidad de ruido aleatorio.</span></span>
<span id="cb69-631"><a href="#cb69-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-634"><a href="#cb69-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-635"><a href="#cb69-635" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas) <span class="sc">+</span></span>
<span id="cb69-636"><a href="#cb69-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cilindrada, <span class="at">y =</span> autopista), <span class="at">position =</span> <span class="st">"jitter"</span>)</span>
<span id="cb69-637"><a href="#cb69-637" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-638"><a href="#cb69-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-639"><a href="#cb69-639" aria-hidden="true" tabindex="-1"></a><span class="at">**Agregar aleatoriedad a los puntos puede parecer una forma extraña de mejorar tu gráfico**. Si bien hace que sea menos preciso a escalas pequeñas, lo hace ser más revelador a gran escala. Como esta es una operación tan útil, ggplot2 incluye una abreviatura de geom_point(position = "jitter"): geom_jitter().</span></span>
<span id="cb69-640"><a href="#cb69-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-641"><a href="#cb69-641" aria-hidden="true" tabindex="-1"></a><span class="at">Para obtener más información sobre ajustes de posición, busca la página de ayuda asociada con cada ajuste: ?position_dodge, ?position_fill, ?position_identity, ?position_jitter y ?position_stack.</span></span>
<span id="cb69-642"><a href="#cb69-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-643"><a href="#cb69-643" aria-hidden="true" tabindex="-1"></a><span class="at">[**Ejercicios**]{style="color:blue"}</span></span>
<span id="cb69-644"><a href="#cb69-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-645"><a href="#cb69-645" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Cuál es el problema con este gráfico? ¿Cómo podrías mejorarlo?</span></span>
<span id="cb69-646"><a href="#cb69-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-649"><a href="#cb69-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-650"><a href="#cb69-650" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-651"><a href="#cb69-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb69-652"><a href="#cb69-652" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-653"><a href="#cb69-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-654"><a href="#cb69-654" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Qué parámetros de geom_jitter() controlan la cantidad de ruido?</span></span>
<span id="cb69-655"><a href="#cb69-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-656"><a href="#cb69-656" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- Compara y contrasta geom_jitter() con geom_count()</span></span>
<span id="cb69-657"><a href="#cb69-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-658"><a href="#cb69-658" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Cuál es el ajuste de posición predeterminado de geom_boxplot()? Crea una visualización del conjunto de datos de millas que lo demuestre.</span></span>
<span id="cb69-659"><a href="#cb69-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-660"><a href="#cb69-660" aria-hidden="true" tabindex="-1"></a><span class="at">## Sistemas de coordenadas</span></span>
<span id="cb69-661"><a href="#cb69-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-662"><a href="#cb69-662" aria-hidden="true" tabindex="-1"></a><span class="at">Los sistemas de coordenadas son probablemente la parte más complicada de ggplot2. El sistema predeterminado es el sistema de coordenadas cartesianas, donde las posiciones x e y actúan independientemente para determinar la ubicación de cada punto. Hay varios otros sistemas de coordenadas que ocasionalmente son útiles.</span></span>
<span id="cb69-663"><a href="#cb69-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-664"><a href="#cb69-664" aria-hidden="true" tabindex="-1"></a><span class="at">-   **coord_flip() cambia los ejes x e y**. Esto es útil, por ejemplo, si quieres **diagramas de caja horizontales**. También es útil para etiquetas largas: es difícil ajustarlas sin que se superpongan en el eje x.</span></span>
<span id="cb69-665"><a href="#cb69-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-668"><a href="#cb69-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-669"><a href="#cb69-669" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-670"><a href="#cb69-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb69-671"><a href="#cb69-671" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> clase, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-672"><a href="#cb69-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb69-673"><a href="#cb69-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb69-674"><a href="#cb69-674" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-675"><a href="#cb69-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-676"><a href="#cb69-676" aria-hidden="true" tabindex="-1"></a><span class="at">-   **coord_quickmap() establece correctamente la relación de aspecto para los mapas**. Esto es muy importante si graficas datos espaciales con ggplot2 (tema para el que, desafortunadamente, no contamos con espacio para desarrollar en este libro).</span></span>
<span id="cb69-677"><a href="#cb69-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-680"><a href="#cb69-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-681"><a href="#cb69-681" aria-hidden="true" tabindex="-1"></a>nz <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"nz"</span>)</span>
<span id="cb69-682"><a href="#cb69-682" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb69-683"><a href="#cb69-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span>
<span id="cb69-684"><a href="#cb69-684" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nz, <span class="fu">aes</span>(long, lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb69-685"><a href="#cb69-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb69-686"><a href="#cb69-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span>
<span id="cb69-687"><a href="#cb69-687" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-688"><a href="#cb69-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-689"><a href="#cb69-689" aria-hidden="true" tabindex="-1"></a><span class="at">-   **coord_polar() usa coordenadas polares**. Las coordenadas polares revelan una conexión interesante entre un gráfico de barras y un gráfico de Coxcomb.</span></span>
<span id="cb69-690"><a href="#cb69-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-693"><a href="#cb69-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-694"><a href="#cb69-694" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diamantes) <span class="sc">+</span></span>
<span id="cb69-695"><a href="#cb69-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb69-696"><a href="#cb69-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> corte, <span class="at">fill =</span> corte),</span>
<span id="cb69-697"><a href="#cb69-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-698"><a href="#cb69-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb69-699"><a href="#cb69-699" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-700"><a href="#cb69-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-701"><a href="#cb69-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb69-702"><a href="#cb69-702" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb69-703"><a href="#cb69-703" aria-hidden="true" tabindex="-1"></a>bar <span class="sc">+</span> <span class="fu">coord_polar</span>()</span>
<span id="cb69-704"><a href="#cb69-704" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-705"><a href="#cb69-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-706"><a href="#cb69-706" aria-hidden="true" tabindex="-1"></a><span class="at">[**Ejercicios**]{style="color:blue"}</span></span>
<span id="cb69-707"><a href="#cb69-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-708"><a href="#cb69-708" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- Convierte un gráfico de barras apiladas en un gráfico circular usando coord_polar().</span></span>
<span id="cb69-709"><a href="#cb69-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-710"><a href="#cb69-710" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Qué hace labs()? Lee la documentación.</span></span>
<span id="cb69-711"><a href="#cb69-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-712"><a href="#cb69-712" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Cuál es la diferencia entre coord_quickmap() y coord_map()?</span></span>
<span id="cb69-713"><a href="#cb69-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-714"><a href="#cb69-714" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;span style="color:blue"&gt;- ¿Qué te dice la gráfica siguiente sobre la relación entre ciudad y autopista? ¿Por qué es coord_fixed() importante? ¿Qué hace geom_abline()?</span></span>
<span id="cb69-715"><a href="#cb69-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-718"><a href="#cb69-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb69-719"><a href="#cb69-719" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> millas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ciudad, <span class="at">y =</span> autopista)) <span class="sc">+</span></span>
<span id="cb69-720"><a href="#cb69-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-721"><a href="#cb69-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb69-722"><a href="#cb69-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb69-723"><a href="#cb69-723" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-724"><a href="#cb69-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-725"><a href="#cb69-725" aria-hidden="true" tabindex="-1"></a><span class="at">## La gramática de gráficos en capas</span></span>
<span id="cb69-726"><a href="#cb69-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-727"><a href="#cb69-727" aria-hidden="true" tabindex="-1"></a><span class="at">En las secciones anteriores aprendiste mucho más que solo hacer diagramas de dispersión, gráficos de barras y diagramas de caja. Aprendiste una base que se puede usar para hacer cualquier tipo de gráfico con ggplot2. Para ver esto, agreguemos ajustes de posición, transformaciones estadísticas, sistemas de coordenadas y facetas a nuestra plantilla de código:</span></span>
<span id="cb69-728"><a href="#cb69-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-729"><a href="#cb69-729" aria-hidden="true" tabindex="-1"></a><span class="st">```</span>{r eval<span class="ot">=</span><span class="cn">FALSE</span>, include<span class="ot">=</span><span class="cn">TRUE</span>}</span>
<span id="cb69-730"><a href="#cb69-730" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATOS<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb69-731"><a href="#cb69-731" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>GEOM_FUNCIÓN<span class="sc">&gt;</span>(</span>
<span id="cb69-732"><a href="#cb69-732" aria-hidden="true" tabindex="-1"></a>   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPEOS<span class="sc">&gt;</span>),</span>
<span id="cb69-733"><a href="#cb69-733" aria-hidden="true" tabindex="-1"></a>   <span class="at">stat =</span> <span class="sc">&lt;</span>ESTADÍSTICAS<span class="sc">&gt;</span>,</span>
<span id="cb69-734"><a href="#cb69-734" aria-hidden="true" tabindex="-1"></a>   <span class="at">position =</span> <span class="sc">&lt;</span>POSICIÓN<span class="sc">&gt;</span></span>
<span id="cb69-735"><a href="#cb69-735" aria-hidden="true" tabindex="-1"></a> ) <span class="sc">+</span></span>
<span id="cb69-736"><a href="#cb69-736" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_COORDENADAS<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb69-737"><a href="#cb69-737" aria-hidden="true" tabindex="-1"></a> <span class="er">&lt;</span>FUNCIÓN_FACETAS<span class="sc">&gt;</span></span>
<span id="cb69-738"><a href="#cb69-738" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb69-739"><a href="#cb69-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-740"><a href="#cb69-740" aria-hidden="true" tabindex="-1"></a><span class="at">Nuestra nueva plantilla tiene siete parámetros que se corresponden con las palabras entre corchetes que aparecen en la plantilla. En la práctica, rara vez necesitas proporcionar los siete parámetros para hacer un gráfico porque ggplot2 proporcionará valores predeterminados útiles para todos, excepto para los datos, el mapeo y la función geom.</span></span>
<span id="cb69-741"><a href="#cb69-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-742"><a href="#cb69-742" aria-hidden="true" tabindex="-1"></a><span class="at">Los siete parámetros en la plantilla componen la gramática de los gráficos, un sistema formal de construcción de gráficos. La gramática de los gráficos se basa en la idea de que puedes describir de manera única cualquier gráfico como una combinación de un conjunto de datos, un geom, un conjunto de mapeos, una estadística, un ajuste de posición, un sistema de coordenadas y un esquema de facetado.</span></span>
<span id="cb69-743"><a href="#cb69-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-744"><a href="#cb69-744" aria-hidden="true" tabindex="-1"></a><span class="at">Para ver cómo funciona esto, considera cómo podrías construir un gráfico básico desde cero: podrías comenzar con un conjunto de datos y luego transformarlo en la información que deseas mostrar (con un stat).</span></span>
<span id="cb69-745"><a href="#cb69-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-746"><a href="#cb69-746" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;p align="center"&gt;</span></span>
<span id="cb69-747"><a href="#cb69-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-748"><a href="#cb69-748" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-1.svg" width="900"/&gt;</span></span>
<span id="cb69-749"><a href="#cb69-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-750"><a href="#cb69-750" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;/p&gt;</span></span>
<span id="cb69-751"><a href="#cb69-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-752"><a href="#cb69-752" aria-hidden="true" tabindex="-1"></a><span class="at">A continuación, podrías elegir un objeto geométrico para representar cada observación en los datos transformados. Luego, podrías usar las propiedades estéticas de los geoms para representar variables de los datos. Asignarías los valores de cada variable a los niveles de una estética.</span></span>
<span id="cb69-753"><a href="#cb69-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-754"><a href="#cb69-754" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;p align="center"&gt;</span></span>
<span id="cb69-755"><a href="#cb69-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-756"><a href="#cb69-756" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-2.svg" width="900"/&gt;</span></span>
<span id="cb69-757"><a href="#cb69-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-758"><a href="#cb69-758" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;/p&gt;</span></span>
<span id="cb69-759"><a href="#cb69-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-760"><a href="#cb69-760" aria-hidden="true" tabindex="-1"></a><span class="at">Posteriormente, podrías seleccionar un sistema de coordenadas para colocar los geoms. Podrías utilizar la ubicación de los objetos (que es en sí misma una propiedad estética) para mostrar los valores de las variables x e y. Ya en este punto podrías tener un gráfico completo, pero también podrías ajustar aún más las posiciones de los geoms dentro del sistema de coordenadas (un ajuste de posición) o dividir el gráfico en facetas. También podrías extender el gráfico agregando una o más capas adicionales, donde cada capa adicional usaría un conjunto de datos, un geom, un conjunto de mapeos, una estadística y un ajuste de posición.</span></span>
<span id="cb69-761"><a href="#cb69-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-762"><a href="#cb69-762" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;p align="center"&gt;</span></span>
<span id="cb69-763"><a href="#cb69-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-764"><a href="#cb69-764" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;img src="https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/visualization-grammar-3.svg" width="900"/&gt;</span></span>
<span id="cb69-765"><a href="#cb69-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-766"><a href="#cb69-766" aria-hidden="true" tabindex="-1"></a><span class="at">&lt;/p&gt;</span></span>
<span id="cb69-767"><a href="#cb69-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-768"><a href="#cb69-768" aria-hidden="true" tabindex="-1"></a><span class="at">Puedes usar este método para construir cualquier gráfico que imagines. En otras palabras, puedes usar la plantilla de código que aprendiste en este capítulo para construir cientos de miles de gráficos únicos.</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright (c) | Powered by <a href="https://quarto.org/">Quarto</a> <!--?quarto.version?--></div>   
  </div>
</footer>



</body></html>